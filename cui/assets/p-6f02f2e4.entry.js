/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{r as t,k as s,i,F as e,H as o,j as a}from"./p-18a64bdb.js";import{c as n,z as r,ab as h}from"./p-675e89df.js";import{A as l}from"./p-52af63d3.js";import{o as c,m as d}from"./p-c7bc8265.js";import{b as p}from"./p-ac6d60ea.js";import{C as u,H as f}from"./p-cb5bbf71.js";import{S as m}from"./p-d0978ff0.js";import{a as y}from"./p-b0df58a1.js";import"./p-0462f723.js";import"./p-fd1eb924.js";const b=t=>t.match(/^\d{4}$/);const v=".set-pin-container{border-radius:var(--components-universal-borderRadius);padding:var(--components-universal-padding);background-color:var(--components-universal-backgroundColor);border:var(--components-universal-borderWidth) solid var(--components-universal-borderColor);overflow:hidden;box-sizing:border-box}.set-pin-header,.set-pin-body{background:var(--styles-background-surfacePrimaryColor)}.setpin-form{display:flex;flex-direction:column;flex:1;justify-content:space-between}";const g=v;const P=n.get(r);const I=class{constructor(i){t(this,i);this.mqSetPinLoadInitiated=s(this,"mqSetPinLoadInitiated",7);this.mqSetPinLoadCompleted=s(this,"mqSetPinLoadCompleted",7);this.mqSetPinActionTriggered=s(this,"mqSetPinActionTriggered",7);this.mqSetPinActionCompleted=s(this,"mqSetPinActionCompleted",7);this.mqSetPinActionHook=s(this,"mqSetPinActionHook",7);this.errorMessages={CARDS_TOO_MANY_ATTEMPTS:"We are unable to set your PIN due to too many attempts. Please contact customer support for assistance.",CARDS_WEAK_PIN:"PIN is too easy to guess. Choose a different PIN."};this.loadCardInfo=async()=>{try{await this.tryToLoadCard()}catch(t){this.handleCardLoadingError(t)}};this.tryToLoadCard=async()=>{this.isLoading=true;const t=await P.execute(this.cardToken);const{state:s}=t;this.isDisabled=p.SUSPENDED===s;this.isLoading=false};this.validatePinsMatch=()=>{if(this.pin&&this.pinConfirm&&b(this.pin)&&b(this.pinConfirm)&&this.pin!==this.pinConfirm){this.pinConfirmError="PIN does not match"}else if(this.pin&&this.pinConfirm&&b(this.pin)&&b(this.pinConfirm)){this.pinConfirmError=""}};this.resetPinInputs=()=>{this.pin="";this.pinConfirm="";this.pinError="";this.pinConfirmError="";this.pinRef.clearInputAndHidePassword();this.pinConfirmRef.clearInputAndHidePassword()};this.handlePinInput=t=>{const{inputElement:{name:s},inputValue:i}=t.detail;if(s==="pin"){this.pin=i;this.pinError=""}else if(s==="pin2"){this.pinConfirm=i;this.pinConfirmError=""}this.validatePinsMatch()};this.handlePinFocusOut=()=>{if(this.pin&&this.pin.length!==4||this.pin&&!b(this.pin)){this.pinError="Invalid PIN"}else if(!this.pin){this.pinError="Enter PIN"}else{this.validatePinsMatch()}};this.handlePinConfirmFocusOut=()=>{if(this.pinConfirm&&this.pinConfirm.length!==4||this.pinConfirm&&!b(this.pinConfirm)){this.pinConfirmError="Invalid PIN"}else if(!this.pinConfirm){this.pinConfirmError="Enter PIN"}else{this.validatePinsMatch()}};this.handleSubmitValidator=()=>{if(!this.pin||!this.pinConfirm){this.readyForSubmit=false}else if(this.pin&&!b(this.pin)||this.pinConfirm&&!b(this.pinConfirm)){this.readyForSubmit=false}else if(this.pin!==this.pinConfirm){this.readyForSubmit=false}else{this.readyForSubmit=true}};this.limitInputToNumbers=t=>{y(t)};this.setPin=async t=>{t.preventDefault();this.mqSetPinActionTriggered.emit({type:m.SET_PIN,data:{cardToken:this.cardToken}});this.isLoading=true;const s=this.isAfterActivation?"setPin":"changePin";const i=n.get(h);try{const t=this.el.shadowRoot.querySelector('form input[name="pin"]');const e=this.el.shadowRoot.querySelector('form input[name="pin2"]');const o=t.value;if(this.pinError||this.pinConfirmError)return;const{card:{lastFour:a}}=await i.execute(o,this.cardToken);t.value="";e.value="";l.CardManagement.setPinSuccess(s);this.mqSetPinActionCompleted.emit({type:m.SET_PIN,status:u.SUCCESS,data:{cardToken:this.cardToken,lastFour:a}})}catch(t){this.handleError(t,s)}finally{this.isLoading=false}};this.getSubmitButtonLabelText=()=>{const t=this.isAfterActivation?"Activate card":"Set PIN";return t};this.cardToken=undefined;this.isAfterActivation=undefined;this.showTitle=undefined;this.showDescription=undefined;this.isLoading=false;this.errorMessage=null;this.pin="";this.pinConfirm="";this.pinConfirmError="";this.pinError="";this.readyForSubmit=false;this.isDisabled=true}handleKeyDown(t){if(t.key==="Escape"){this.mqSetPinActionHook.emit({type:f.SUCCESS_DONE,data:{cardToken:this.cardToken}})}}connectedCallback(){c((async t=>{if(t){await this.loadCardInfo();setTimeout((()=>this.mqSetPinLoadCompleted.emit({status:u.SUCCESS})),0)}}))}handleCardLoadingError(t){var s;const i=t;const e=(s=i===null||i===void 0?void 0:i.originalError)===null||s===void 0?void 0:s.message;this.errorMessage=i.message;this.isLoading=false;this.mqSetPinLoadCompleted.emit({status:u.ERROR,error:{code:e||"INTERNAL_ERROR"}})}handleError(t,s){var i;console.log({error:t});const e="There was a problem setting your PIN. Please contact customer support for assistance.";const o=(i=t===null||t===void 0?void 0:t.originalError)===null||i===void 0?void 0:i.message;this.errorMessage=this.errorMessages[o]||e;this.resetPinInputs();this.readyForSubmit=false;l.CardManagement.setPinError(s);this.mqSetPinActionCompleted.emit({type:m.SET_PIN,status:u.ERROR,error:{code:o||"INTERNAL_ERROR",message:this.errorMessage},data:{cardToken:this.cardToken}})}render(){if(!d.mqCuiReady){return null}return i(o,null,i("theme-provider",null,i("div",{class:"set-pin-container"},i("div",{class:"set-pin-header",style:{display:this.showTitle||this.showDescription?"block":"none"}},i("flex-container",{flex:"initial",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",gap:"var(--spacing-spacing200)"},this.showTitle&&i("mq-text",{type:"heading"},"Set PIN"),this.showDescription&&i("mq-text",{styleOverride:{color:"var(--styles-text-textSecondaryColor)"}},"Avoid simple PINs such as sequences (1234) or repeated digits (1111).")),i("mq-vspacer",{factor:5})),i("div",{class:"set-pin-body"},i("form",{class:"setpin-form",onSubmit:this.setPin,"accept-charset":"UTF-8",autocomplete:"off"},this.errorMessage&&i(e,null,i("mq-alert",{type:"error"},this.errorMessage),i("mq-vspacer",{factor:5})),i("div",null,i("mq-input",{"auto-focus":true,name:"pin",label:"Enter 4-digit PIN",type:"password",maxlength:"4",disabled:this.isLoading||this.isDisabled,onKeyPress:this.limitInputToNumbers,onFocusout:this.handlePinFocusOut,onInputChange:this.handlePinInput,onKeyUp:this.handleSubmitValidator,error:this.pinError,ref:t=>this.pinRef=t}),i("mq-vspacer",{factor:5}),i("mq-input",{name:"pin2",label:"Confirm 4-digit PIN",type:"password",maxlength:"4",disabled:this.isLoading||this.isDisabled,onKeyPress:this.limitInputToNumbers,onFocusout:this.handlePinConfirmFocusOut,onInputChange:this.handlePinInput,onKeyUp:this.handleSubmitValidator,error:this.pinConfirmError,ref:t=>this.pinConfirmRef=t}),i("mq-vspacer",{factor:5})),i("flex-container",{flexDirection:"row",justifyContent:"flex-end"},i("mq-button",{kind:"primary",small:true,label:this.getSubmitButtonLabelText(),type:"submit",disabled:!this.readyForSubmit||this.isDisabled,loading:this.isLoading,onClick:this.setPin})))))))}static get assetsDirs(){return["assets"]}get el(){return a(this)}};I.style=g;export{I as set_pin};
//# sourceMappingURL=p-6f02f2e4.entry.js.map