/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{s as e,l as t,f as s,c as r,I as n,a as i,b as o,d as a,e as u,g as c,r as l,m as h,h as d,i as f,j as p,k as v,n as m,o as g,p as w,q as y,t as b}from"./p-675e89df.js";import{e as q}from"./p-18a64bdb.js";import{m as k}from"./p-c7bc8265.js";const R=4*60*1e3;async function x({authToken:c,cuiAuthToken:h,assetPath:d,themeName:f,envName:p="production",enableRumAgent:v=true,platformType:m}){console.log("starting bootstrap");if(m&&m.toLowerCase()==="react-native"){e(l)}q(d||E());if(window.marqeta&&window.marqeta.token!==undefined){return}if(h){console.warn("cuiAuthToken is deprecated, please use authToken instead")}const g=h||c;if(!g){throw new Error("Auth token is required")}window.marqeta=window.marqeta||{};window.marqeta.token=g;await t();if(s("dna_component_gating")){await S()}const w=r.get(n);await w.execute(p);const y=r.get(i);const{theme:b}=y.execute();if(!b){const e=r.get(o);await e.execute(f)}const x=r.get(a);window.addEventListener("beforeunload",(async()=>await x.execute()));k.mqCuiReady=true;await u(R);if(v){I(p)}}function E(){const e=import.meta.url.replace(/[^/]*$/,"");let t=`${e}public/`;if(e.substring(e.length-5)==="/esm/"){t=e.replace(/esm\/$/,"sdk-web-components/public/")}return t}async function S(){try{await c()}catch(e){console.error(e)}}function I(e){import("./p-b34ca94c.js").then((({datadogRum:t})=>{t.init({applicationId:"46355412-f46d-4365-a03d-ff82afc2396b",clientToken:"pub7af8aca29e982e93b07805940c95a311",site:"datadoghq.com",service:"cui-sdk-web",env:e,sessionSampleRate:100,sessionReplaySampleRate:20,trackUserInteractions:true,trackResources:true,trackLongTasks:true,defaultPrivacyLevel:"mask-user-input"})}))}var L=/(%?)(%([sdijo]))/g;function T(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if(typeof e==="string"){return e}const t=JSON.stringify(e);if(t==="{}"||t==="[]"||/^\[object .+?\]$/.test(t)){return e}return t}}}function O(e,...t){if(t.length===0){return e}let s=0;let r=e.replace(L,((e,r,n,i)=>{const o=t[s];const a=T(o,i);if(!r){s++;return a}return e}));if(s<t.length){r+=` ${t.slice(s).join(" ")}`}r=r.replace(/%{2,2}/g,"%");return r}var j=2;function M(e){if(!e.stack){return}const t=e.stack.split("\n");t.splice(1,j);e.stack=t.join("\n")}var C=class extends Error{constructor(e,...t){super(e);this.message=e;this.name="Invariant Violation";this.message=O(e,...t);M(this)}};var P=(e,t,...s)=>{if(!e){throw new C(t,...s)}};P.as=(e,t,s,...r)=>{if(!t){const t=r.length===0?s:O(s,r);let n;try{n=Reflect.construct(e,[t])}catch(s){n=e(t)}throw n}};const A="[MSW]";function $(e,...t){const s=O(e,...t);return`${A} ${s}`}function W(e,...t){console.warn($(e,...t))}function N(e,...t){console.error($(e,...t))}const U={formatMessage:$,warn:W,error:N};class D extends Error{constructor(e){super(e);this.name="InternalError"}}const H=/[\/\\]msw[\/\\]src[\/\\](.+)/;const _=/(node_modules)?[\/\\]lib[\/\\](core|browser|node|native|iife)[\/\\]|^[^\/\\]*$/;function F(e){const t=e.stack;if(!t){return}const s=t.split("\n").slice(1);const r=s.find((e=>!(H.test(e)||_.test(e))));if(!r){return}const n=r.replace(/\s*at [^()]*\(([^)]+)\)/,"$1").replace(/^@/,"");return n}function G(e){if(!e){return false}return typeof e[Symbol.iterator]=="function"}class X{static cache=new WeakMap;info;isUsed;resolver;resolverGenerator;resolverGeneratorResult;options;constructor(e){this.resolver=e.resolver;this.options=e.options;const t=F(new Error);this.info={...e.info,callFrame:t};this.isUsed=false}async parse(e){return{}}async test(e){const t=await this.parse({request:e.request,resolutionContext:e.resolutionContext});return this.predicate({request:e.request,parsedResult:t,resolutionContext:e.resolutionContext})}extendResolverArgs(e){return{}}cloneRequestOrGetFromCache(e){const t=X.cache.get(e);if(typeof t!=="undefined"){return t}const s=e.clone();X.cache.set(e,s);return s}async run(e){if(this.isUsed&&this.options?.once){return null}const t=this.cloneRequestOrGetFromCache(e.request);const s=await this.parse({request:e.request,resolutionContext:e.resolutionContext});const r=this.predicate({request:e.request,parsedResult:s,resolutionContext:e.resolutionContext});if(!r){return null}if(this.isUsed&&this.options?.once){return null}this.isUsed=true;const n=this.wrapResolver(this.resolver);const i=this.extendResolverArgs({request:e.request,parsedResult:s});const o=n({...i,requestId:e.requestId,request:e.request}).catch((e=>{if(e instanceof Response){return e}throw e}));const a=await o;const u=this.createExecutionResult({request:t,requestId:e.requestId,response:a,parsedResult:s});return u}wrapResolver(e){return async t=>{const s=this.resolverGenerator||await e(t);if(G(s)){this.isUsed=false;const{value:e,done:t}=s[Symbol.iterator]().next();const r=await e;if(t){this.isUsed=true}if(!r&&t){P(this.resolverGeneratorResult,"Failed to returned a previously stored generator response: the value is not a valid Response.");return this.resolverGeneratorResult.clone()}if(!this.resolverGenerator){this.resolverGenerator=s}if(r){this.resolverGeneratorResult=r?.clone()}return r}return s}}createExecutionResult(e){return{handler:this,request:e.request,requestId:e.requestId,response:e.response,parsedResult:e.parsedResult}}}var J=async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}};const B=async({request:e,requestId:t,handlers:s,resolutionContext:r})=>{let n=null;let i=null;for(const o of s){i=await o.run({request:e,requestId:t,resolutionContext:r});if(i!==null){n=o}if(i?.response){break}}if(n){return{handler:n,parsedResult:i?.parsedResult,response:i?.response}}return null};function K(e){if(typeof location==="undefined"){return e.toString()}const t=e instanceof URL?e:new URL(e);return t.origin===location.origin?t.pathname:t.origin+t.pathname}async function V(e,t="warn"){const s=new URL(e.url);const r=K(s)+s.search;const n=`intercepted a request without a matching request handler:\n\n  â€¢ ${e.method} ${r}\n\nIf you still wish to intercept this unhandled request, please create a request handler for it.\nRead more: https://mswjs.io/docs/getting-started/mocks`;function i(e){switch(e){case"error":{U.error("Error: %s",n);throw new D(U.formatMessage('Cannot bypass a request when using the "error" strategy for the "onUnhandledRequest" option.'))}case"warn":{U.warn("Warning: %s",n);break}case"bypass":break;default:throw new D(U.formatMessage('Failed to react to an unhandled request: unknown strategy "%s". Please provide one of the supported strategies ("bypass", "warn", "error") or a custom callback function as the value of the "onUnhandledRequest" option.',e))}}if(typeof t==="function"){t(e,{warning:i.bind(null,"warn"),error:i.bind(null,"error")});return}if(s.protocol==="file:"){return}i(t)}var Y=Object.create;var Q=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf;var te=Object.prototype.hasOwnProperty;var se=(e,t)=>function s(){return t||(0,e[Z(e)[0]])((t={exports:{}}).exports,t),t.exports};var re=(e,t,s,r)=>{if(t&&typeof t==="object"||typeof t==="function"){for(let n of Z(t))if(!te.call(e,n)&&n!==s)Q(e,n,{get:()=>t[n],enumerable:!(r=z(t,n))||r.enumerable})}return e};var ne=(e,t,s)=>(s=e!=null?Y(ee(e)):{},re(t||!e||!e.__esModule?Q(s,"default",{value:e,enumerable:true}):s,e));var ie=se({"node_modules/set-cookie-parser/lib/set-cookie.js"(e,t){var s={decodeValues:true,map:false,silent:false};function r(e){return typeof e==="string"&&!!e.trim()}function n(e,t){var n=e.split(";").filter(r);var o=n.shift();var a=i(o);var u=a.name;var c=a.value;t=t?Object.assign({},s,t):s;try{c=t.decodeValues?decodeURIComponent(c):c}catch(e){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+c+"'. Set options.decodeValues to false to disable this feature.",e)}var l={name:u,value:c};n.forEach((function(e){var t=e.split("=");var s=t.shift().trimLeft().toLowerCase();var r=t.join("=");if(s==="expires"){l.expires=new Date(r)}else if(s==="max-age"){l.maxAge=parseInt(r,10)}else if(s==="secure"){l.secure=true}else if(s==="httponly"){l.httpOnly=true}else if(s==="samesite"){l.sameSite=r}else{l[s]=r}}));return l}function i(e){var t="";var s="";var r=e.split("=");if(r.length>1){t=r.shift();s=r.join("=")}else{s=e}return{name:t,value:s}}function o(e,t){t=t?Object.assign({},s,t):s;if(!e){if(!t.map){return[]}else{return{}}}if(e.headers){if(typeof e.headers.getSetCookie==="function"){e=e.headers.getSetCookie()}else if(e.headers["set-cookie"]){e=e.headers["set-cookie"]}else{var i=e.headers[Object.keys(e.headers).find((function(e){return e.toLowerCase()==="set-cookie"}))];if(!i&&e.headers.cookie&&!t.silent){console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning.")}e=i}}if(!Array.isArray(e)){e=[e]}t=t?Object.assign({},s,t):s;if(!t.map){return e.filter(r).map((function(e){return n(e,t)}))}else{var o={};return e.filter(r).reduce((function(e,s){var r=n(s,t);e[r.name]=r;return e}),o)}}function a(e){if(Array.isArray(e)){return e}if(typeof e!=="string"){return[]}var t=[];var s=0;var r;var n;var i;var o;var a;function u(){while(s<e.length&&/\s/.test(e.charAt(s))){s+=1}return s<e.length}function c(){n=e.charAt(s);return n!=="="&&n!==";"&&n!==","}while(s<e.length){r=s;a=false;while(u()){n=e.charAt(s);if(n===","){i=s;s+=1;u();o=s;while(s<e.length&&c()){s+=1}if(s<e.length&&e.charAt(s)==="="){a=true;s=o;t.push(e.substring(r,i));r=s}else{s=i+1}}else{s+=1}}if(!a||s>=e.length){t.push(e.substring(r,e.length))}}return t}t.exports=o;t.exports.parse=o;t.exports.parseString=n;t.exports.splitCookiesString=a}});var oe=ne(ie());var ae="MSW_COOKIE_STORE";function ue(){try{if(localStorage==null){return false}const e=ae+"_test";localStorage.setItem(e,"test");localStorage.getItem(e);localStorage.removeItem(e);return true}catch(e){return false}}function ce(e,t){try{return true}catch{return false}}var le=class{constructor(){this.store=new Map}add(e,t){if(ce()&&e.credentials==="omit"){return}const s=new URL(e.url);const r=t.headers.get("set-cookie");if(!r){return}const n=Date.now();const i=(0,oe.parse)(r).map((({maxAge:e,...t})=>({...t,expires:e===void 0?t.expires:new Date(n+e*1e3),maxAge:e})));const o=this.store.get(s.origin)||new Map;i.forEach((e=>{this.store.set(s.origin,o.set(e.name,e))}))}get(e){this.deleteExpiredCookies();const t=new URL(e.url);const s=this.store.get(t.origin)||new Map;if(!ce()){return s}switch(e.credentials){case"include":{if(typeof document==="undefined"){return s}const e=(0,oe.parse)(document.cookie);e.forEach((e=>{s.set(e.name,e)}));return s}case"same-origin":{return s}default:return new Map}}getAll(){this.deleteExpiredCookies();return this.store}deleteAll(e){const t=new URL(e.url);this.store.delete(t.origin)}clear(){this.store.clear()}hydrate(){if(!ue()){return}const e=localStorage.getItem(ae);if(!e){return}try{const t=JSON.parse(e);t.forEach((([e,t])=>{this.store.set(e,new Map(t.map((([e,{expires:t,...s}])=>[e,t===void 0?s:{...s,expires:new Date(t)}]))))}))}catch(e){console.warn(`\n[virtual-cookie] Failed to parse a stored cookie from the localStorage (key "${ae}").\n\nStored value:\n${localStorage.getItem(ae)}\n\nThrown exception:\n${e}\n\nInvalid value has been removed from localStorage to prevent subsequent failed parsing attempts.`);localStorage.removeItem(ae)}}persist(){if(!ue()){return}const e=Array.from(this.store.entries()).map((([e,t])=>[e,Array.from(t.entries())]));localStorage.setItem(ae,JSON.stringify(e))}deleteExpiredCookies(){const e=Date.now();this.store.forEach(((t,s)=>{t.forEach((({expires:s,name:r})=>{if(s!==void 0&&s.getTime()<=e){t.delete(r)}}));if(t.size===0){this.store.delete(s)}}))}};var he=new le;function de(e,t){he.add({...e,url:e.url.toString()},t);he.persist()}async function fe(e,t,s,r,n,i){n.emit("request:start",{request:e,requestId:t});if(e.headers.get("x-msw-intention")==="bypass"){n.emit("request:end",{request:e,requestId:t});i?.onPassthroughResponse?.(e);return}const o=await J((()=>B({request:e,requestId:t,handlers:s,resolutionContext:i?.resolutionContext})));if(o.error){n.emit("unhandledException",{error:o.error,request:e,requestId:t});throw o.error}if(!o.data){await V(e,r.onUnhandledRequest);n.emit("request:unhandled",{request:e,requestId:t});n.emit("request:end",{request:e,requestId:t});i?.onPassthroughResponse?.(e);return}const{response:a}=o.data;if(!a){n.emit("request:end",{request:e,requestId:t});i?.onPassthroughResponse?.(e);return}if(a.status===302&&a.headers.get("x-msw-intention")==="passthrough"){n.emit("request:end",{request:e,requestId:t});i?.onPassthroughResponse?.(e);return}de(e,a);n.emit("request:match",{request:e,requestId:t});const u=o.data;const c=i?.transformResponse?.(a)||a;i?.onMockedResponse?.(c,u);n.emit("request:end",{request:e,requestId:t});return c}function pe(e){return{status:e.status,statusText:e.statusText,headers:Object.fromEntries(e.headers.entries())}}function ve(e){return e!=null&&typeof e==="object"&&!Array.isArray(e)}function me(e,t){return Object.entries(t).reduce(((e,[t,s])=>{const r=e[t];if(Array.isArray(r)&&Array.isArray(s)){e[t]=r.concat(s);return e}if(ve(r)&&ve(s)){e[t]=me(r,s);return e}e[t]=s;return e}),Object.assign({},e))}var ge=class extends Error{constructor(e,t,s){super(`Possible EventEmitter memory leak detected. ${s} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`);this.emitter=e;this.type=t;this.count=s;this.name="MaxListenersExceededWarning"}};var we=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map;this.maxListeners=we.defaultMaxListeners;this.hasWarnedAboutPotentialMemoryLeak=false}_emitInternalEvent(e,t,s){this.emit(e,...[t,s])}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const s=e.indexOf(t);if(s>-1){e.splice(s,1)}return[]}_wrapOnceListener(e,t){const s=(...r)=>{this.removeListener(e,s);return t.apply(this,r)};Object.defineProperty(s,"name",{value:t.name});return s}setMaxListeners(e){this.maxListeners=e;return this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const s=this._getListeners(e);s.forEach((e=>{e.apply(this,t)}));return s.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const s=this._getListeners(e).concat(t);this.events.set(e,s);if(this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=true;const t=new ge(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const s=this._getListeners(e);if(s.length>0){const r=[t].concat(s);this.events.set(e,r)}else{this.events.set(e,s.concat(t))}return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const s=this._getListeners(e);if(s.length>0){this._removeListener(s,t);this.events.set(e,s);this._emitInternalEvent("removeListener",e,t)}return this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){if(e){this.events.delete(e)}else{this.events.clear()}return this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}};var ye=we;ye.defaultMaxListeners=10;function be(e,t){const s=e.emit;if(s._isPiped){return}const r=function e(r,...n){t.emit(r,...n);return s.call(this,r,...n)};r._isPiped=true;e.emit=r}function qe(e){const t=[...e];Object.freeze(t);return t}class ke{subscriptions=[];dispose(){let e;while(e=this.subscriptions.shift()){e()}}}class Re{constructor(e){this.initialHandlers=e;this.handlers=[...e]}handlers;prepend(e){this.handlers.unshift(...e)}reset(e){this.handlers=e.length>0?[...e]:[...this.initialHandlers]}currentHandlers(){return this.handlers}}class xe extends ke{handlersController;emitter;publicEmitter;events;constructor(...e){super();P(this.validateHandlers(e),U.formatMessage(`Failed to apply given request handlers: invalid input. Did you forget to spread the request handlers Array?`));this.handlersController=new Re(e);this.emitter=new ye;this.publicEmitter=new ye;be(this.emitter,this.publicEmitter);this.events=this.createLifeCycleEvents();this.subscriptions.push((()=>{this.emitter.removeAllListeners();this.publicEmitter.removeAllListeners()}))}validateHandlers(e){return e.every((e=>!Array.isArray(e)))}use(...e){P(this.validateHandlers(e),U.formatMessage(`Failed to call "use()" with the given request handlers: invalid input. Did you forget to spread the array of request handlers?`));this.handlersController.prepend(e)}restoreHandlers(){this.handlersController.currentHandlers().forEach((e=>{e.isUsed=false}))}resetHandlers(...e){this.handlersController.reset(e)}listHandlers(){return qe(this.handlersController.currentHandlers())}createLifeCycleEvents(){return{on:(...e)=>this.publicEmitter.on(...e),removeListener:(...e)=>this.publicEmitter.removeListener(...e),removeAllListeners:(...e)=>this.publicEmitter.removeAllListeners(...e)}}}var Ee=/(%?)(%([sdijo]))/g;function Se(e,t){switch(t){case"s":return e;case"d":case"i":return Number(e);case"j":return JSON.stringify(e);case"o":{if(typeof e==="string"){return e}const t=JSON.stringify(e);if(t==="{}"||t==="[]"||/^\[object .+?\]$/.test(t)){return e}return t}}}function Ie(e,...t){if(t.length===0){return e}let s=0;let r=e.replace(Ee,((e,r,n,i)=>{const o=t[s];const a=Se(o,i);if(!r){s++;return a}return e}));if(s<t.length){r+=` ${t.slice(s).join(" ")}`}r=r.replace(/%{2,2}/g,"%");return r}var Le=2;function Te(e){if(!e.stack){return}const t=e.stack.split("\n");t.splice(1,Le);e.stack=t.join("\n")}var Oe=class extends Error{constructor(e,...t){super(e);this.message=e;this.name="Invariant Violation";this.message=Ie(e,...t);Te(this)}};var je=(e,t,...s)=>{if(!e){throw new Oe(t,...s)}};je.as=(e,t,s,...r)=>{if(!t){const t=r.length===0?s:Ie(s,r);let n;try{n=Reflect.construct(e,[t])}catch(s){n=e(t)}throw n}};function Me(){if(typeof navigator!=="undefined"&&navigator.product==="ReactNative"){return true}if(typeof process!=="undefined"){const e=process.type;if(e==="renderer"||e==="worker"){return false}return!!(process.versions&&process.versions.node)}return false}var Ce=async e=>{try{const t=await e().catch((e=>{throw e}));return{error:null,data:t}}catch(e){return{error:e,data:null}}};function Pe(e){return new URL(e,location.href).href}function Ae(e,t,s){const r=[e.active,e.installing,e.waiting];const n=r.filter((e=>e!=null));const i=n.find((e=>s(e.scriptURL,t)));return i||null}var $e=async(e,t={},s)=>{const r=Pe(e);const n=await navigator.serviceWorker.getRegistrations().then((e=>e.filter((e=>Ae(e,r,s)))));if(!navigator.serviceWorker.controller&&n.length>0){location.reload()}const[i]=n;if(i){return i.update().then((()=>[Ae(i,r,s),i]))}const o=await Ce((async()=>{const n=await navigator.serviceWorker.register(e,t);return[Ae(n,r,s),n]}));if(o.error){const e=o.error.message.includes("(404)");if(e){const e=new URL(t?.scope||"/",location.href);throw new Error(U.formatMessage(`Failed to register a Service Worker for scope ('${e.href}') with script ('${r}'): Service Worker script does not exist at the given path.\n\nDid you forget to run "npx msw init <PUBLIC_DIR>"?\n\nLearn more about creating the Service Worker script: https://mswjs.io/docs/cli/init`))}throw new Error(U.formatMessage("Failed to register the Service Worker:\n\n%s",o.error.message))}return o.data};function We(e={}){if(e.quiet){return}const t=e.message||"Mocking enabled.";console.groupCollapsed(`%c${U.formatMessage(t)}`,"color:orangered;font-weight:bold;");console.log("%cDocumentation: %chttps://mswjs.io/docs","font-weight:bold","font-weight:normal");console.log("Found an issue? https://github.com/mswjs/msw/issues");if(e.workerUrl){console.log("Worker script URL:",e.workerUrl)}if(e.workerScope){console.log("Worker scope:",e.workerScope)}console.groupEnd()}async function Ne(e,t){e.workerChannel.send("MOCK_ACTIVATE");await e.events.once("MOCKING_ENABLED");if(e.isMockingEnabled){U.warn(`Found a redundant "worker.start()" call. Note that starting the worker while mocking is already enabled will have no effect. Consider removing this "worker.start()" call.`);return}e.isMockingEnabled=true;We({quiet:t.quiet,workerScope:e.registration?.scope,workerUrl:e.worker?.scriptURL})}var Ue=class{constructor(e){this.port=e}postMessage(e,...t){const[s,r]=t;this.port.postMessage({type:e,data:s},{transfer:r})}};function De(e){if(["HEAD","GET"].includes(e.method)){return void 0}return e.body}function He(e){return new Request(e.url,{...e,body:De(e)})}var _e=(e,t)=>async(s,r)=>{const n=new Ue(s.ports[0]);const i=r.payload.id;const o=He(r.payload);const a=o.clone();const u=o.clone();X.cache.set(o,u);e.requests.set(i,u);try{await fe(o,i,e.getRequestHandlers(),t,e.emitter,{onPassthroughResponse(){n.postMessage("PASSTHROUGH")},async onMockedResponse(s,{handler:r,parsedResult:i}){const o=s.clone();const u=s.clone();const c=pe(s);if(e.supports.readableStreamTransfer){const e=s.body;n.postMessage("MOCK_RESPONSE",{...c,body:e},e?[e]:void 0)}else{const e=s.body===null?null:await o.arrayBuffer();n.postMessage("MOCK_RESPONSE",{...c,body:e})}if(!t.quiet){e.emitter.once("response:mocked",(()=>{r.log({request:a,response:u,parsedResult:i})}))}}})}catch(e){if(e instanceof Error){U.error(`Uncaught exception in the request handler for "%s %s":\n\n%s\n\nThis exception has been gracefully handled as a 500 response, however, it's strongly recommended to resolve this error, as it indicates a mistake in your code. If you wish to mock an error response, please see this guide: https://mswjs.io/docs/recipes/mocking-error-responses`,o.method,o.url,e.stack??e);n.postMessage("MOCK_RESPONSE",{status:500,statusText:"Request Handler Error",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,message:e.message,stack:e.stack})})}}};async function Fe(e){e.workerChannel.send("INTEGRITY_CHECK_REQUEST");const{payload:t}=await e.events.once("INTEGRITY_CHECK_RESPONSE");if(t.checksum!=="26357c79639bfa20d64c0efca2a87423"){U.warn(`The currently registered Service Worker has been generated by a different version of MSW (${t.packageVersion}) and may not be fully compatible with the installed version.\n\nIt's recommended you update your worker script by running this command:\n\n  â€¢ npx msw init <PUBLIC_DIR>\n\nYou can also automate this process and make the worker script update automatically upon the library installations. Read more: https://mswjs.io/docs/cli/init.`)}}var Ge=new TextEncoder;function Xe(e){return Ge.encode(e)}function Je(e,t){const s=new TextDecoder(t);return s.decode(e)}function Be(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}var Ke=Symbol("isPatchedModule");function Ve(e,t){try{return true}catch(e){return false}}var Ye=new Set([101,103,204,205,304]);function Qe(e){return Ye.has(e)}function ze(e){return new Response(JSON.stringify(e instanceof Error?{name:e.name,message:e.message,stack:e.stack}:e),{status:500,statusText:"Unhandled Exception",headers:{"Content-Type":"application/json"}})}function Ze(e){return Ve()&&e.type==="error"}var et=Object.defineProperty;var tt=(e,t)=>{for(var s in t)et(e,s,{get:t[s],enumerable:true})};var st={};tt(st,{blue:()=>nt,gray:()=>it,green:()=>at,red:()=>ot,yellow:()=>rt});function rt(e){return`[33m${e}[0m`}function nt(e){return`[34m${e}[0m`}function it(e){return`[90m${e}[0m`}function ot(e){return`[31m${e}[0m`}function at(e){return`[32m${e}[0m`}var ut=Me();var ct=class{constructor(e){this.name=e;this.prefix=`[${this.name}]`;const t=vt("DEBUG");const s=vt("LOG_LEVEL");const r=t==="1"||t==="true"||typeof t!=="undefined"&&this.name.startsWith(t);if(r){this.debug=mt(s,"debug")?ht:this.debug;this.info=mt(s,"info")?ht:this.info;this.success=mt(s,"success")?ht:this.success;this.warning=mt(s,"warning")?ht:this.warning;this.error=mt(s,"error")?ht:this.error}else{this.info=ht;this.success=ht;this.warning=ht;this.error=ht;this.only=ht}}prefix;extend(e){return new ct(`${this.name}:${e}`)}debug(e,...t){this.logEntry({level:"debug",message:it(e),positionals:t,prefix:this.prefix,colors:{prefix:"gray"}})}info(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}});const s=new lt;return(e,...t)=>{s.measure();this.logEntry({level:"info",message:`${e} ${it(`${s.deltaTime}ms`)}`,positionals:t,prefix:this.prefix,colors:{prefix:"blue"}})}}success(e,...t){this.logEntry({level:"info",message:e,positionals:t,prefix:`âœ” ${this.prefix}`,colors:{timestamp:"green",prefix:"green"}})}warning(e,...t){this.logEntry({level:"warning",message:e,positionals:t,prefix:`âš  ${this.prefix}`,colors:{timestamp:"yellow",prefix:"yellow"}})}error(e,...t){this.logEntry({level:"error",message:e,positionals:t,prefix:`âœ– ${this.prefix}`,colors:{timestamp:"red",prefix:"red"}})}only(e){e()}createEntry(e,t){return{timestamp:new Date,level:e,message:t}}logEntry(e){const{level:t,message:s,prefix:r,colors:n,positionals:i=[]}=e;const o=this.createEntry(t,s);const a=n?.timestamp||"gray";const u=n?.prefix||"gray";const c={timestamp:st[a],prefix:st[u]};const l=this.getWriter(t);l([c.timestamp(this.formatTimestamp(o.timestamp))].concat(r!=null?c.prefix(r):[]).concat(gt(s)).join(" "),...i.map(gt))}formatTimestamp(e){return`${e.toLocaleTimeString("en-GB")}:${e.getMilliseconds()}`}getWriter(e){switch(e){case"debug":case"success":case"info":{return dt}case"warning":{return ft}case"error":{return pt}}}};var lt=class{startTime;endTime;deltaTime;constructor(){this.startTime=performance.now()}measure(){this.endTime=performance.now();const e=this.endTime-this.startTime;this.deltaTime=e.toFixed(2)}};var ht=()=>void 0;function dt(e,...t){if(ut){process.stdout.write(Ie(e,...t)+"\n");return}console.log(e,...t)}function ft(e,...t){if(ut){process.stderr.write(Ie(e,...t)+"\n");return}console.warn(e,...t)}function pt(e,...t){if(ut){process.stderr.write(Ie(e,...t)+"\n");return}console.error(e,...t)}function vt(e){if(ut){return process.env[e]}return globalThis[e]?.toString()}function mt(e,t){return e!==void 0&&e!==t}function gt(e){if(typeof e==="undefined"){return"undefined"}if(e===null){return"null"}if(typeof e==="string"){return e}if(typeof e==="object"){return JSON.stringify(e)}return e.toString()}var wt=class extends Error{constructor(e,t,s){super(`Possible EventEmitter memory leak detected. ${s} ${t.toString()} listeners added. Use emitter.setMaxListeners() to increase limit`);this.emitter=e;this.type=t;this.count=s;this.name="MaxListenersExceededWarning"}};var yt=class{static listenerCount(e,t){return e.listenerCount(t)}constructor(){this.events=new Map;this.maxListeners=yt.defaultMaxListeners;this.hasWarnedAboutPotentialMemoryLeak=false}_emitInternalEvent(e,t,s){this.emit(e,...[t,s])}_getListeners(e){return Array.prototype.concat.apply([],this.events.get(e))||[]}_removeListener(e,t){const s=e.indexOf(t);if(s>-1){e.splice(s,1)}return[]}_wrapOnceListener(e,t){const s=(...r)=>{this.removeListener(e,s);return t.apply(this,r)};Object.defineProperty(s,"name",{value:t.name});return s}setMaxListeners(e){this.maxListeners=e;return this}getMaxListeners(){return this.maxListeners}eventNames(){return Array.from(this.events.keys())}emit(e,...t){const s=this._getListeners(e);s.forEach((e=>{e.apply(this,t)}));return s.length>0}addListener(e,t){this._emitInternalEvent("newListener",e,t);const s=this._getListeners(e).concat(t);this.events.set(e,s);if(this.maxListeners>0&&this.listenerCount(e)>this.maxListeners&&!this.hasWarnedAboutPotentialMemoryLeak){this.hasWarnedAboutPotentialMemoryLeak=true;const t=new wt(this,e,this.listenerCount(e));console.warn(t)}return this}on(e,t){return this.addListener(e,t)}once(e,t){return this.addListener(e,this._wrapOnceListener(e,t))}prependListener(e,t){const s=this._getListeners(e);if(s.length>0){const r=[t].concat(s);this.events.set(e,r)}else{this.events.set(e,s.concat(t))}return this}prependOnceListener(e,t){return this.prependListener(e,this._wrapOnceListener(e,t))}removeListener(e,t){const s=this._getListeners(e);if(s.length>0){this._removeListener(s,t);this.events.set(e,s);this._emitInternalEvent("removeListener",e,t)}return this}off(e,t){return this.removeListener(e,t)}removeAllListeners(e){if(e){this.events.delete(e)}else{this.events.clear()}return this}listeners(e){return Array.from(this._getListeners(e))}listenerCount(e){return this._getListeners(e).length}rawListeners(e){return this.listeners(e)}};var bt=yt;bt.defaultMaxListeners=10;var qt="x-interceptors-internal-request-id";function kt(e){return globalThis[e]||void 0}function Rt(e,t){globalThis[e]=t}function xt(e){delete globalThis[e]}var Et=class{constructor(e){this.symbol=e;this.readyState="INACTIVE";this.emitter=new bt;this.subscriptions=[];this.logger=new ct(e.description);this.emitter.setMaxListeners(0);this.logger.info("constructing the interceptor...")}checkEnvironment(){return true}apply(){const e=this.logger.extend("apply");e.info("applying the interceptor...");if(this.readyState==="APPLIED"){e.info("intercepted already applied!");return}const t=this.checkEnvironment();if(!t){e.info("the interceptor cannot be applied in this environment!");return}this.readyState="APPLYING";const s=this.getInstance();if(s){e.info("found a running instance, reusing...");this.on=(t,r)=>{e.info('proxying the "%s" listener',t);s.emitter.addListener(t,r);this.subscriptions.push((()=>{s.emitter.removeListener(t,r);e.info('removed proxied "%s" listener!',t)}));return this};this.readyState="APPLIED";return}e.info("no running instance found, setting up a new instance...");this.setup();this.setInstance();this.readyState="APPLIED"}setup(){}on(e,t){const s=this.logger.extend("on");if(this.readyState==="DISPOSING"||this.readyState==="DISPOSED"){s.info("cannot listen to events, already disposed!");return this}s.info('adding "%s" event listener:',e,t);this.emitter.on(e,t);return this}once(e,t){this.emitter.once(e,t);return this}off(e,t){this.emitter.off(e,t);return this}removeAllListeners(e){this.emitter.removeAllListeners(e);return this}dispose(){const e=this.logger.extend("dispose");if(this.readyState==="DISPOSED"){e.info("cannot dispose, already disposed!");return}e.info("disposing the interceptor...");this.readyState="DISPOSING";if(!this.getInstance()){e.info("no interceptors running, skipping dispose...");return}this.clearInstance();e.info("global symbol deleted:",kt(this.symbol));if(this.subscriptions.length>0){e.info("disposing of %d subscriptions...",this.subscriptions.length);for(const e of this.subscriptions){e()}this.subscriptions=[];e.info("disposed of all subscriptions!",this.subscriptions.length)}this.emitter.removeAllListeners();e.info("destroyed the listener!");this.readyState="DISPOSED"}getInstance(){var e;const t=kt(this.symbol);this.logger.info("retrieved global instance:",(e=t==null?void 0:t.constructor)==null?void 0:e.name);return t}setInstance(){Rt(this.symbol,this);this.logger.info("set global instance!",this.symbol.description)}clearInstance(){xt(this.symbol);this.logger.info("cleared global instance!",this.symbol.description)}};function St(){return Math.random().toString(16).slice(2)}var It=class extends Et{constructor(e){It.symbol=Symbol(e.name);super(It.symbol);this.interceptors=e.interceptors}setup(){const e=this.logger.extend("setup");e.info("applying all %d interceptors...",this.interceptors.length);for(const t of this.interceptors){e.info('applying "%s" interceptor...',t.constructor.name);t.apply();e.info("adding interceptor dispose subscription");this.subscriptions.push((()=>t.dispose()))}}on(e,t){for(const s of this.interceptors){s.on(e,t)}return this}once(e,t){for(const s of this.interceptors){s.once(e,t)}return this}off(e,t){for(const s of this.interceptors){s.off(e,t)}return this}removeAllListeners(e){for(const t of this.interceptors){t.removeAllListeners(e)}return this}};function Lt(e){return(t,s)=>{const{payload:r}=s;const{requestId:n}=r;const i=e.requests.get(n);e.requests.delete(n);if(r.type?.includes("opaque")){return}const o=r.status===0?Response.error():new Response(Qe(r.status)?null:r.body,r);if(!o.url){Object.defineProperty(o,"url",{value:i.url,enumerable:true,writable:false})}e.emitter.emit(r.isMockedResponse?"response:mocked":"response:bypass",{response:o,request:i,requestId:r.requestId})}}function Tt(e,t){if(!t?.quiet&&!location.href.startsWith(e.scope)){U.warn(`Cannot intercept requests on this page because it's outside of the worker's scope ("${e.scope}"). If you wish to mock API requests on this page, you must resolve this scope issue.\n\n- (Recommended) Register the worker at the root level ("/") of your application.\n- Set the "Service-Worker-Allowed" response header to allow out-of-scope workers.`)}}var Ot=e=>function t(s,r){const n=async()=>{e.events.removeAllListeners();e.workerChannel.on("REQUEST",_e(e,s));e.workerChannel.on("RESPONSE",Lt(e));const t=await $e(s.serviceWorker.url,s.serviceWorker.options,s.findWorker);const[n,i]=t;if(!n){const e=r?.findWorker?U.formatMessage(`Failed to locate the Service Worker registration using a custom "findWorker" predicate.\n\nPlease ensure that the custom predicate properly locates the Service Worker registration at "%s".\nMore details: https://mswjs.io/docs/api/setup-worker/start#findworker\n`,s.serviceWorker.url):U.formatMessage(`Failed to locate the Service Worker registration.\n\nThis most likely means that the worker script URL "%s" cannot resolve against the actual public hostname (%s). This may happen if your application runs behind a proxy, or has a dynamic hostname.\n\nPlease consider using a custom "serviceWorker.url" option to point to the actual worker script location, or a custom "findWorker" option to resolve the Service Worker registration manually. More details: https://mswjs.io/docs/api/setup-worker/start`,s.serviceWorker.url,location.host);throw new Error(e)}e.worker=n;e.registration=i;e.events.addListener(window,"beforeunload",(()=>{if(n.state!=="redundant"){e.workerChannel.send("CLIENT_CLOSED")}window.clearInterval(e.keepAliveInterval)}));await Fe(e).catch((e=>{U.error("Error while checking the worker script integrity. Please report this on GitHub (https://github.com/mswjs/msw/issues), including the original error below.");console.error(e)}));e.keepAliveInterval=window.setInterval((()=>e.workerChannel.send("KEEPALIVE_REQUEST")),5e3);Tt(i,e.startOptions);return i};const i=n().then((async t=>{const r=t.installing||t.waiting;if(r){await new Promise((e=>{r.addEventListener("statechange",(()=>{if(r.state==="activated"){return e()}}))}))}await Ne(e,s).catch((e=>{throw new Error(`Failed to enable mocking: ${e?.message}`)}));return t}));return i};function jt(e={}){if(e.quiet){return}console.log(`%c${U.formatMessage("Mocking disabled.")}`,"color:orangered;font-weight:bold;")}var Mt=e=>function t(){if(!e.isMockingEnabled){U.warn('Found a redundant "worker.stop()" call. Note that stopping the worker while mocking already stopped has no effect. Consider removing this "worker.stop()" call.');return}e.workerChannel.send("MOCK_DEACTIVATE");e.isMockingEnabled=false;window.clearInterval(e.keepAliveInterval);jt({quiet:e.startOptions?.quiet})};var Ct={serviceWorker:{url:"/mockServiceWorker.js",options:null},quiet:false,waitUntilReady:true,onUnhandledRequest:"warn",findWorker(e,t){return e===t}};function Pt(){const e=(t,s)=>{e.state="pending";e.resolve=s=>{if(e.state!=="pending"){return}e.result=s;const r=t=>{e.state="fulfilled";return t};return t(s instanceof Promise?s:Promise.resolve(s).then(r))};e.reject=t=>{if(e.state!=="pending"){return}queueMicrotask((()=>{e.state="rejected"}));return s(e.rejectionReason=t)}};return e}var At=class extends Promise{#e;resolve;reject;constructor(e=null){const t=Pt();super(((s,r)=>{t(s,r);e?.(t.resolve,t.reject)}));this.#e=t;this.resolve=this.#e.resolve;this.reject=this.#e.reject}get state(){return this.#e.state}get rejectionReason(){return this.#e.rejectionReason}then(e,t){return this.#t(super.then(e,t))}catch(e){return this.#t(super.catch(e))}finally(e){return this.#t(super.finally(e))}#t(e){return Object.defineProperties(e,{resolve:{configurable:true,value:this.resolve},reject:{configurable:true,value:this.reject}})}};var $t=class{constructor(e){this.request=e;this.responsePromise=new At}respondWith(e){je(this.responsePromise.state==="pending",'Failed to respond to "%s %s" request: the "request" event has already been responded to.',this.request.method,this.request.url);this.responsePromise.resolve(e)}};function Wt(e){const t=new $t(e);Reflect.set(e,"respondWith",t.respondWith.bind(t));return{interactiveRequest:e,requestController:t}}async function Nt(e,t,...s){const r=e.listeners(t);if(r.length===0){return}for(const t of r){await t.apply(e,s)}}function Ut(e){try{new URL(e);return true}catch(e){return false}}var Dt=class extends Et{constructor(){super(Dt.symbol)}checkEnvironment(){return typeof globalThis!=="undefined"&&typeof globalThis.fetch!=="undefined"}async setup(){const e=globalThis.fetch;je(!e[Ke],'Failed to patch the "fetch" module: already patched.');globalThis.fetch=async(t,s)=>{var r;const n=St();const i=typeof t==="string"&&typeof location!=="undefined"&&!Ut(t)?new URL(t,location.origin):t;const o=new Request(i,s);this.logger.info("[%s] %s",o.method,o.url);const{interactiveRequest:a,requestController:u}=Wt(o);this.logger.info('emitting the "request" event for %d listener(s)...',this.emitter.listenerCount("request"));this.emitter.once("request",(({requestId:e})=>{if(e!==n){return}if(u.responsePromise.state==="pending"){u.responsePromise.resolve(void 0)}}));this.logger.info("awaiting for the mocked response...");const c=a.signal;const l=new At;if(c){c.addEventListener("abort",(()=>{l.reject(c.reason)}),{once:true})}const h=new At;const d=e=>{this.logger.info("responding with a mock response:",e);if(this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:true,request:a,requestId:n})}Object.defineProperty(e,"url",{writable:false,enumerable:true,configurable:false,value:o.url});h.resolve(e)};const f=e=>{h.reject(e)};const p=await Ce((async()=>{const e=Nt(this.emitter,"request",{request:a,requestId:n});await Promise.race([l,e,u.responsePromise]);this.logger.info("all request listeners have been resolved!");const t=await u.responsePromise;this.logger.info("event.respondWith called with:",t);return t}));if(l.state==="rejected"){this.logger.info("request has been aborted:",l.rejectionReason);h.reject(l.rejectionReason);return h}if(p.error){this.logger.info("request listerner threw an error:",p.error);if(p.error instanceof Response){if(Ze(p.error)){f(_t(p.error))}else{d(p.error)}}if(this.emitter.listenerCount("unhandledException")>0){await Nt(this.emitter,"unhandledException",{error:p.error,request:o,requestId:n,controller:{respondWith:d,errorWith:f}});if(h.state!=="pending"){return h}}d(ze(p.error));return h}const v=p.data;if(v&&!((r=o.signal)==null?void 0:r.aborted)){this.logger.info("received mocked response:",v);if(Ze(v)){this.logger.info("received a network error response, rejecting the request promise...");f(_t(v))}else{d(v)}return h}this.logger.info("no mocked response received!");return e(o).then((e=>{this.logger.info("original fetch performed",e);if(this.emitter.listenerCount("response")>0){this.logger.info('emitting the "response" event...');const t=e.clone();this.emitter.emit("response",{response:t,isMockedResponse:false,request:a,requestId:n})}return e}))};Object.defineProperty(globalThis.fetch,Ke,{enumerable:true,configurable:true,value:true});this.subscriptions.push((()=>{Object.defineProperty(globalThis.fetch,Ke,{value:void 0});globalThis.fetch=e;this.logger.info('restored native "globalThis.fetch"!',globalThis.fetch.name)}))}};var Ht=Dt;Ht.symbol=Symbol("fetch");function _t(e){return Object.assign(new TypeError("Failed to fetch"),{cause:e})}function Ft(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);s.set(e,0);s.set(t,e.byteLength);return s}var Gt=class{constructor(e,t){this.AT_TARGET=0;this.BUBBLING_PHASE=0;this.CAPTURING_PHASE=0;this.NONE=0;this.type="";this.srcElement=null;this.currentTarget=null;this.eventPhase=0;this.isTrusted=true;this.composed=false;this.cancelable=true;this.defaultPrevented=false;this.bubbles=true;this.lengthComputable=true;this.loaded=0;this.total=0;this.cancelBubble=false;this.returnValue=true;this.type=e;this.target=(t==null?void 0:t.target)||null;this.currentTarget=(t==null?void 0:t.currentTarget)||null;this.timeStamp=Date.now()}composedPath(){return[]}initEvent(e,t,s){this.type=e;this.bubbles=!!t;this.cancelable=!!s}preventDefault(){this.defaultPrevented=true}stopPropagation(){}stopImmediatePropagation(){}};var Xt=class extends Gt{constructor(e,t){super(e);this.lengthComputable=(t==null?void 0:t.lengthComputable)||false;this.composed=(t==null?void 0:t.composed)||false;this.loaded=(t==null?void 0:t.loaded)||0;this.total=(t==null?void 0:t.total)||0}};var Jt=typeof ProgressEvent!=="undefined";function Bt(e,t,s){const r=["error","progress","loadstart","loadend","load","timeout","abort"];const n=Jt?ProgressEvent:Xt;const i=r.includes(t)?new n(t,{lengthComputable:true,loaded:(s==null?void 0:s.loaded)||0,total:(s==null?void 0:s.total)||0}):new Gt(t,{target:e,currentTarget:e});return i}function Kt(e,t){if(!(t in e)){return null}const s=Object.prototype.hasOwnProperty.call(e,t);if(s){return e}const r=Reflect.getPrototypeOf(e);return r?Kt(r,t):null}function Vt(e,t){const s=new Proxy(e,Yt(t));return s}function Yt(e){const{constructorCall:t,methodCall:s,getProperty:r,setProperty:n}=e;const i={};if(typeof t!=="undefined"){i.construct=function(e,s,r){const n=Reflect.construct.bind(null,e,s,r);return t.call(r,s,n)}}i.set=function(e,t,s){const r=()=>{const r=Kt(e,t)||e;const n=Reflect.getOwnPropertyDescriptor(r,t);if(typeof(n==null?void 0:n.set)!=="undefined"){n.set.apply(e,[s]);return true}return Reflect.defineProperty(r,t,{writable:true,enumerable:true,configurable:true,value:s})};if(typeof n!=="undefined"){return n.call(e,[t,s],r)}return r()};i.get=function(e,t,n){const i=()=>e[t];const o=typeof r!=="undefined"?r.call(e,[t,n],i):i();if(typeof o==="function"){return(...r)=>{const n=o.bind(e,...r);if(typeof s!=="undefined"){return s.call(e,[t,r],n)}return n()}}return o};return i}function Qt(e){const t=["application/xhtml+xml","application/xml","image/svg+xml","text/html","text/xml"];return t.some((t=>e.startsWith(t)))}function zt(e){try{const t=JSON.parse(e);return t}catch(e){return null}}function Zt(e,t){const s=Qe(e.status)?null:t;return new Response(s,{status:e.status,statusText:e.statusText,headers:es(e.getAllResponseHeaders())})}function es(e){const t=new Headers;const s=e.split(/[\r\n]+/);for(const e of s){if(e.trim()===""){continue}const[s,...r]=e.split(": ");const n=r.join(": ");t.append(s,n)}return t}var ts=Symbol("isMockedResponse");var ss=Me();var rs=class{constructor(e,t){this.initialRequest=e;this.logger=t;this.method="GET";this.url=null;this.events=new Map;this.requestId=St();this.requestHeaders=new Headers;this.responseBuffer=new Uint8Array;this.request=Vt(e,{setProperty:([e,t],s)=>{switch(e){case"ontimeout":{const r=e.slice(2);this.request.addEventListener(r,t);return s()}default:{return s()}}},methodCall:([e,t],s)=>{var r;switch(e){case"open":{const[e,r]=t;if(typeof r==="undefined"){this.method="GET";this.url=ns(e)}else{this.method=e;this.url=ns(r)}this.logger=this.logger.extend(`${this.method} ${this.url.href}`);this.logger.info("open",this.method,this.url.href);return s()}case"addEventListener":{const[e,r]=t;this.registerEvent(e,r);this.logger.info("addEventListener",e,r);return s()}case"setRequestHeader":{const[e,r]=t;this.requestHeaders.set(e,r);this.logger.info("setRequestHeader",e,r);return s()}case"send":{const[e]=t;if(e!=null){this.requestBody=typeof e==="string"?Xe(e):e}this.request.addEventListener("load",(()=>{if(typeof this.onResponse!=="undefined"){const e=Zt(this.request,this.request.response);this.onResponse.call(this,{response:e,isMockedResponse:ts in this.request,request:n,requestId:this.requestId})}}));const n=this.toFetchApiRequest();const i=((r=this.onRequest)==null?void 0:r.call(this,{request:n,requestId:this.requestId}))||Promise.resolve();i.finally((()=>{if(this.request.readyState<this.request.LOADING){this.logger.info("request callback settled but request has not been handled (readystate %d), performing as-is...",this.request.readyState);if(ss){this.request.setRequestHeader(qt,this.requestId)}return s()}}));break}default:{return s()}}}})}registerEvent(e,t){const s=this.events.get(e)||[];const r=s.concat(t);this.events.set(e,r);this.logger.info('registered event "%s"',e,t)}respondWith(e){this.logger.info("responding with a mocked response: %d %s",e.status,e.statusText);is(this.request,ts,true);is(this.request,"status",e.status);is(this.request,"statusText",e.statusText);is(this.request,"responseURL",this.url.href);this.request.getResponseHeader=new Proxy(this.request.getResponseHeader,{apply:(t,s,r)=>{this.logger.info("getResponseHeader",r[0]);if(this.request.readyState<this.request.HEADERS_RECEIVED){this.logger.info("headers not received yet, returning null");return null}const n=e.headers.get(r[0]);this.logger.info('resolved response header "%s" to',r[0],n);return n}});this.request.getAllResponseHeaders=new Proxy(this.request.getAllResponseHeaders,{apply:()=>{this.logger.info("getAllResponseHeaders");if(this.request.readyState<this.request.HEADERS_RECEIVED){this.logger.info("headers not received yet, returning empty string");return""}const t=Array.from(e.headers.entries());const s=t.map((([e,t])=>`${e}: ${t}`)).join("\r\n");this.logger.info("resolved all response headers to",s);return s}});Object.defineProperties(this.request,{response:{enumerable:true,configurable:false,get:()=>this.response},responseText:{enumerable:true,configurable:false,get:()=>this.responseText},responseXML:{enumerable:true,configurable:false,get:()=>this.responseXML}});const t=e.headers.has("Content-Length")?Number(e.headers.get("Content-Length")):void 0;this.logger.info("calculated response body length",t);this.trigger("loadstart",{loaded:0,total:t});this.setReadyState(this.request.HEADERS_RECEIVED);this.setReadyState(this.request.LOADING);const s=()=>{this.logger.info("finalizing the mocked response...");this.setReadyState(this.request.DONE);this.trigger("load",{loaded:this.responseBuffer.byteLength,total:t});this.trigger("loadend",{loaded:this.responseBuffer.byteLength,total:t})};if(e.body){this.logger.info("mocked response has body, streaming...");const r=e.body.getReader();const n=async()=>{const{value:e,done:i}=await r.read();if(i){this.logger.info("response body stream done!");s();return}if(e){this.logger.info("read response body chunk:",e);this.responseBuffer=Ft(this.responseBuffer,e);this.trigger("progress",{loaded:this.responseBuffer.byteLength,total:t})}n()};n()}else{s()}}responseBufferToText(){return Je(this.responseBuffer)}get response(){this.logger.info("getResponse (responseType: %s)",this.request.responseType);if(this.request.readyState!==this.request.DONE){return null}switch(this.request.responseType){case"json":{const e=zt(this.responseBufferToText());this.logger.info("resolved response JSON",e);return e}case"arraybuffer":{const e=Be(this.responseBuffer);this.logger.info("resolved response ArrayBuffer",e);return e}case"blob":{const e=this.request.getResponseHeader("Content-Type")||"text/plain";const t=new Blob([this.responseBufferToText()],{type:e});this.logger.info("resolved response Blob (mime type: %s)",t,e);return t}default:{const e=this.responseBufferToText();this.logger.info('resolving "%s" response type as text',this.request.responseType,e);return e}}}get responseText(){je(this.request.responseType===""||this.request.responseType==="text","InvalidStateError: The object is in invalid state.");if(this.request.readyState!==this.request.LOADING&&this.request.readyState!==this.request.DONE){return""}const e=this.responseBufferToText();this.logger.info('getResponseText: "%s"',e);return e}get responseXML(){je(this.request.responseType===""||this.request.responseType==="document","InvalidStateError: The object is in invalid state.");if(this.request.readyState!==this.request.DONE){return null}const e=this.request.getResponseHeader("Content-Type")||"";if(typeof DOMParser==="undefined"){console.warn("Cannot retrieve XMLHttpRequest response body as XML: DOMParser is not defined. You are likely using an environment that is not browser or does not polyfill browser globals correctly.");return null}if(Qt(e)){return(new DOMParser).parseFromString(this.responseBufferToText(),e)}return null}errorWith(e){this.logger.info("responding with an error");this.setReadyState(this.request.DONE);this.trigger("error");this.trigger("loadend")}setReadyState(e){this.logger.info("setReadyState: %d -> %d",this.request.readyState,e);if(this.request.readyState===e){this.logger.info("ready state identical, skipping transition...");return}is(this.request,"readyState",e);this.logger.info("set readyState to: %d",e);if(e!==this.request.UNSENT){this.logger.info('triggerring "readystatechange" event...');this.trigger("readystatechange")}}trigger(e,t){const s=this.request[`on${e}`];const r=Bt(this.request,e,t);this.logger.info('trigger "%s"',e,t||"");if(typeof s==="function"){this.logger.info('found a direct "%s" callback, calling...',e);s.call(this.request,r)}for(const[t,s]of this.events){if(t===e){this.logger.info('found %d listener(s) for "%s" event, calling...',s.length,e);s.forEach((e=>e.call(this.request,r)))}}}toFetchApiRequest(){this.logger.info("converting request to a Fetch API Request...");const e=new Request(this.url.href,{method:this.method,headers:this.requestHeaders,credentials:this.request.withCredentials?"include":"same-origin",body:["GET","HEAD"].includes(this.method)?null:this.requestBody});const t=Vt(e.headers,{methodCall:([t,s],r)=>{switch(t){case"append":case"set":{const[e,t]=s;this.request.setRequestHeader(e,t);break}case"delete":{const[t]=s;console.warn(`XMLHttpRequest: Cannot remove a "${t}" header from the Fetch API representation of the "${e.method} ${e.url}" request. XMLHttpRequest headers cannot be removed.`);break}}return r()}});is(e,"headers",t);this.logger.info("converted request to a Fetch API Request!",e);return e}};function ns(e){if(typeof location==="undefined"){return new URL(e)}return new URL(e.toString(),location.href)}function is(e,t,s){Reflect.defineProperty(e,t,{writable:true,enumerable:true,value:s})}function os({emitter:e,logger:t}){const s=new Proxy(globalThis.XMLHttpRequest,{construct(s,r,n){t.info("constructed new XMLHttpRequest");const i=Reflect.construct(s,r,n);const o=Object.getOwnPropertyDescriptors(s.prototype);for(const e in o){Reflect.defineProperty(i,e,o[e])}const a=new rs(i,t);a.onRequest=async function({request:t,requestId:s}){const{interactiveRequest:r,requestController:n}=Wt(t);this.logger.info("awaiting mocked response...");e.once("request",(({requestId:e})=>{if(e!==s){return}if(n.responsePromise.state==="pending"){n.respondWith(void 0)}}));const o=await Ce((async()=>{this.logger.info('emitting the "request" event for %s listener(s)...',e.listenerCount("request"));await Nt(e,"request",{request:r,requestId:s});this.logger.info('all "request" listeners settled!');const t=await n.responsePromise;this.logger.info("event.respondWith called with:",t);return t}));if(o.error){this.logger.info("request listener threw an exception, aborting request...",o.error);if(o.error instanceof Response){if(Ze(o.error)){a.errorWith(new TypeError("Network error"))}else{this.respondWith(o.error)}return}if(e.listenerCount("unhandledException")>0){await Nt(e,"unhandledException",{error:o.error,request:t,requestId:s,controller:{respondWith:a.respondWith.bind(a),errorWith:a.errorWith.bind(a)}});if(i.readyState>XMLHttpRequest.OPENED){return}}a.respondWith(ze(o.error));return}const u=o.data;if(typeof u!=="undefined"){this.logger.info("received mocked response: %d %s",u.status,u.statusText);if(Ze(u)){this.logger.info("received a network error response, rejecting the request promise...");a.errorWith(new TypeError("Network error"));return}return a.respondWith(u)}this.logger.info("no mocked response received, performing request as-is...")};a.onResponse=async function({response:t,isMockedResponse:s,request:r,requestId:n}){this.logger.info('emitting the "response" event for %s listener(s)...',e.listenerCount("response"));e.emit("response",{response:t,isMockedResponse:s,request:r,requestId:n})};return a.request}});return s}var as=class extends Et{constructor(){super(as.interceptorSymbol)}checkEnvironment(){return typeof globalThis.XMLHttpRequest!=="undefined"}setup(){const e=this.logger.extend("setup");e.info('patching "XMLHttpRequest" module...');const t=globalThis.XMLHttpRequest;je(!t[Ke],'Failed to patch the "XMLHttpRequest" module: already patched.');globalThis.XMLHttpRequest=os({emitter:this.emitter,logger:this.logger});e.info('native "XMLHttpRequest" module patched!',globalThis.XMLHttpRequest.name);Object.defineProperty(globalThis.XMLHttpRequest,Ke,{enumerable:true,configurable:true,value:true});this.subscriptions.push((()=>{Object.defineProperty(globalThis.XMLHttpRequest,Ke,{value:void 0});globalThis.XMLHttpRequest=t;e.info('native "XMLHttpRequest" module restored!',globalThis.XMLHttpRequest.name)}))}};var us=as;us.interceptorSymbol=Symbol("xhr");function cs(e,t){const s=new It({name:"fallback",interceptors:[new Ht,new us]});s.on("request",(async({request:s,requestId:r})=>{const n=s.clone();const i=await fe(s,r,e.getRequestHandlers(),t,e.emitter,{onMockedResponse(s,{handler:r,parsedResult:i}){if(!t.quiet){e.emitter.once("response:mocked",(({response:e})=>{r.log({request:n,response:e,parsedResult:i})}))}}});if(i){s.respondWith(i)}}));s.on("response",(({response:t,isMockedResponse:s,request:r,requestId:n})=>{e.emitter.emit(s?"response:mocked":"response:bypass",{response:t,request:r,requestId:n})}));s.apply();return s}function ls(e){return async function t(s){e.fallbackInterceptor=cs(e,s);We({message:"Mocking enabled (fallback mode).",quiet:s.quiet});return void 0}}function hs(e){return function t(){e.fallbackInterceptor?.dispose();jt({quiet:e.startOptions?.quiet})}}function ds(){try{const e=new ReadableStream({start:e=>e.close()});const t=new MessageChannel;t.port1.postMessage(e,[e]);return true}catch(e){return false}}var fs=class extends xe{context;startHandler=null;stopHandler=null;listeners;constructor(...e){super(...e);je(!Me(),U.formatMessage("Failed to execute `setupWorker` in a non-browser environment. Consider using `setupServer` for Node.js environment instead."));this.listeners=[];this.context=this.createWorkerContext()}createWorkerContext(){const e={isMockingEnabled:false,startOptions:null,worker:null,getRequestHandlers:()=>this.handlersController.currentHandlers(),registration:null,requests:new Map,emitter:this.emitter,workerChannel:{on:(e,t)=>{this.context.events.addListener(navigator.serviceWorker,"message",(s=>{if(s.source!==this.context.worker){return}const r=s.data;if(!r){return}if(r.type===e){t(s,r)}}))},send:e=>{this.context.worker?.postMessage(e)}},events:{addListener:(e,t,s)=>{e.addEventListener(t,s);this.listeners.push({eventType:t,target:e,callback:s});return()=>{e.removeEventListener(t,s)}},removeAllListeners:()=>{for(const{target:e,eventType:t,callback:s}of this.listeners){e.removeEventListener(t,s)}this.listeners=[]},once:e=>{const t=[];return new Promise(((s,r)=>{const n=t=>{try{const r=t.data;if(r.type===e){s(r)}}catch(e){r(e)}};t.push(this.context.events.addListener(navigator.serviceWorker,"message",n),this.context.events.addListener(navigator.serviceWorker,"messageerror",r))})).finally((()=>{t.forEach((e=>e()))}))}},supports:{serviceWorkerApi:!("serviceWorker"in navigator)||location.protocol==="file:",readableStreamTransfer:ds()}};this.startHandler=e.supports.serviceWorkerApi?ls(e):Ot(e);this.stopHandler=e.supports.serviceWorkerApi?hs(e):Mt(e);return e}async start(e={}){if(e.waitUntilReady===true){U.warn('The "waitUntilReady" option has been deprecated. Please remove it from this "worker.start()" call. Follow the recommended Browser integration (https://mswjs.io/docs/integrations/browser) to eliminate any race conditions between the Service Worker registration and any requests made by your application on initial render.')}this.context.startOptions=me(Ct,e);return await this.startHandler(this.context.startOptions,e)}stop(){super.dispose();this.context.events.removeAllListeners();this.context.emitter.removeAllListeners();this.stopHandler()}};function ps(...e){return new fs(...e)}const vs=[...h,...d,...f,...p,...v,...m,...g,...w,...y,...b];class ms{constructor(e){this.isRunning=false;this.options={};this.handlers=[];this.handlers=e}init(e){this.options=e;this.worker=ps(...this.handlers)}async start(){if(!this.isRunning){await this.worker.start(this.options);this.isRunning=true}}async stop(){if(this.isRunning){await this.worker.stop();this.isRunning=false}}}const gs=new ms(vs);export{x as b,gs as m};
//# sourceMappingURL=p-d8241bab.js.map