/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{r as t,k as s,i,F as r,j as e}from"./p-18a64bdb.js";import{o as a,m as n}from"./p-c7bc8265.js";import{A as o}from"./p-52af63d3.js";import{c,z as d,C as h,K as l,L as p,M as u}from"./p-675e89df.js";import{d as m}from"./p-399e25b0.js";import"./p-0462f723.js";const g=":host{display:block;background:var(--components-universal-backgroundColor);border-radius:var(--components-universal-borderRadius);padding:var(--components-universal-padding);border:var(--components-universal-borderWidth) solid var(--components-universal-borderColor)}.mq-card-actions{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:var(--spacing-spacing0);gap:var(--spacing-spacing0);border-radius:var(--borderRadius-radius200);border:var(--styles-border-borderWidth) solid var(--styles-border-borderDefaultColor);background:var(--styles-background-surfacePrimaryColor);box-sizing:border-box}.min-height{min-height:224px}.mq-card-actions-skeleton-row{display:flex;align-items:center;align-self:stretch;padding:var(--spacing-spacing400);gap:var(--spacing-spacing400);position:relative;z-index:1;user-select:none}.mq-card-actions-skeleton-row .mq-bone:nth-of-type(1){border-radius:var(--borderRadius-radiusFull)}.mq-card-actions-skeleton-row .mq-bone:nth-of-type(2){border-radius:var(--borderRadius-radius100)}.mq-card-actions-error{display:flex;flex-direction:column;align-items:center;justify-content:center;width:552px;height:72px;padding:var(--spacing-spacing1000) var(--spacing-spacing600);gap:var(--spacing-spacing400)}@media screen and (max-width: 480px){.mq-card-actions{width:100%}}";const k=g;const y=c.get(d);const b=class{constructor(i){t(this,i);this.mqCardActionsInit=s(this,"mqCardActionsInit",7);this.mqCardActionsLoadSuccess=s(this,"mqCardActionsLoadSuccess",7);this.mqCardActionsLoadError=s(this,"mqCardActionsLoadError",7);this.mqCardActionsSelectActionTriggered=s(this,"mqCardActionsSelectActionTriggered",7);this.mqCardActionsSelectActionSuccess=s(this,"mqCardActionsSelectActionSuccess",7);this.mqCardActionsSelectActionError=s(this,"mqCardActionsSelectActionError",7);this.mqCardActionsLockCardSuccess=s(this,"mqCardActionsLockCardSuccess",7);this.mqCardActionsLockCardError=s(this,"mqCardActionsLockCardError",7);this.mqCardActionsUnlockCardSuccess=s(this,"mqCardActionsUnlockCardSuccess",7);this.mqCardActionsUnlockCardError=s(this,"mqCardActionsUnlockCardError",7);this.cardToken=undefined;this.cardActions=[];this.cardActionsDisabledMap={};this.cardState=undefined;this.errorMessage=null;this.isLoading=true;this.programShortcode=undefined;this.userToken=undefined;this.isToggleSelected=undefined;this.isToggleError=false}toggleChangedEventHandler(t){this.handleCardToggleEvent(t.detail.id)}selectTriggeredEventHandler(t){this.handleCardActionEvent(t.detail.id)}componentWillLoad(){this.debouncedApiCall=m(this.performApiCall.bind(this),500)}connectedCallback(){a((t=>{if(t){this.loadCard()}}));this.mqCardActionsInit.emit({cardToken:this.cardToken})}async loadCard(){this.isLoading=true;this.errorMessage=null;try{await this.tryToLoadCard();const t=this.cardState==u.SUSPENDED;this.isToggleSelected=t;this.mqCardActionsLoadSuccess.emit({cardToken:this.cardToken})}catch(t){const s=t.message;this.errorMessage=s;this.handleError(t,"load")}finally{this.isLoading=false}}async lockCard(){try{await this.tryToLockCard();await this.tryToLoadCard();this.mqCardActionsLockCardSuccess.emit({cardToken:this.cardToken,userToken:this.userToken,programShortcode:this.programShortcode});o.CardManagement.lockCardSuccess()}catch(t){this.handleError(t,"lock");throw t}}async unlockCard(){try{await this.tryToUnlockCard();await this.tryToLoadCard();this.mqCardActionsUnlockCardSuccess.emit({cardToken:this.cardToken,userToken:this.userToken,programShortcode:this.programShortcode});o.CardManagement.unlockCardSuccess()}catch(t){this.handleError(t,"unlock");throw t}}async tryToLoadCard(){const t=await y.execute(this.cardToken);const s=await h();const{cardActions:i,state:r,userToken:e}=t;const a=r==u.SUSPENDED;const n=r==u.ACTIVE||a;const c=i.reduce(((t,s)=>{if(s.id==="lock-card"){t[s.id]=!n}else{t[s.id]=!s.enabled}return t}),{});this.cardActionsDisabledMap=c;this.cardActions=i;this.cardState=r;this.userToken=e;this.programShortcode=s;o.CardManagement.cardActionsLoadSuccess()}async tryToLockCard(){const t=c.get(l);await t.execute(this.cardToken);o.CardManagement.lockCardSuccess()}async tryToUnlockCard(){const t=c.get(p);await t.execute(this.cardToken);o.CardManagement.unlockCardSuccess()}handleError(t,s){const i=t.message;o.CardManagement.Exception(i);const r={cardToken:this.cardToken,errorCode:i};switch(s){case"load":this.mqCardActionsLoadError.emit(r);o.CardManagement.cardActionsLoadError();break;case"lock":this.mqCardActionsLockCardError.emit(r);o.CardManagement.lockCardError();break;case"unlock":this.mqCardActionsUnlockCardError.emit(r);o.CardManagement.unlockCardError();break}}renderBodySkeleton(){return i(r,null,Array.from({length:4},((t,s)=>i("div",{class:"mq-card-actions-skeleton-row",key:s},i("mq-bone",{height:"20px",width:"20px"}),i("mq-bone",{height:"16px",width:"200px"})))))}renderError(){return i("div",{class:"mq-card-actions-error"},i("flex-container",{justifyContent:"space-between",alignItems:"center"},i("mq-text",null,"Unable to load data")),i("flex-container",{justifyContent:"space-between",alignItems:"center"},i("mq-button",{type:"button",kind:"tertiary",onClick:()=>this.loadCard()},"Refresh")))}handleCardActionEvent(t){const s={cardToken:this.cardToken,userToken:this.userToken,programShortcode:this.programShortcode,actionId:t,actionType:"EVENT"};this.mqCardActionsSelectActionTriggered.emit(s);try{this.mqCardActionsSelectActionSuccess.emit(s)}catch(t){this.handleCardActionError(t)}}async performApiCall(){if(this.isToggleSelected){await this.lockCard()}else{await this.unlockCard()}}updateUIState(t,s){this.isToggleSelected=t;this.cardActionsDisabledMap=Object.assign(Object.assign({},this.cardActionsDisabledMap),{"view-pin":t,"change-pin":t});this.cardState=t?u.SUSPENDED:u.ACTIVE;this.isToggleError=s}async handleCardToggleEvent(t){const s={cardToken:this.cardToken,userToken:this.userToken,programShortcode:this.programShortcode,actionId:t,actionType:"TOGGLE"};this.mqCardActionsSelectActionTriggered.emit(s);const i=this.cardState===u.ACTIVE;this.updateUIState(i,false);try{await this.debouncedApiCall();this.mqCardActionsSelectActionSuccess.emit(s)}catch(t){this.updateUIState(!i,true);this.handleCardActionError(t)}}handleCardActionError(t){var s;const i=(s=t===null||t===void 0?void 0:t.originalError)===null||s===void 0?void 0:s.message;this.mqCardActionsSelectActionError.emit({errorCode:i,cardToken:this.cardToken})}renderCardActions(){return this.cardActions.map((t=>{const{id:s,typeIcon:r,actionType:e,titleKey:a,subheadingKey:n}=t;const o=this.cardActionsDisabledMap[s]||false;const c=s==="lock-card"&&!this.isToggleSelected?`${r}_open`:r;const d=o?"var(--styles-icons-iconDisabledColor)":"var(--styles-icons-iconBrandColor)";return i("mq-list-item",{key:s,"data-key":s,itemId:s,icon:c,iconStrokeColor:s!=="change-pin"?d:undefined,iconColor:s==="change-pin"?d:undefined,showToggleAction:e==="TOGGLE",isDisabled:o,titleKey:a,subheadingKey:n,isToggleError:this.isToggleError,isToggleSelected:this.isToggleSelected})}))}render(){if(!this.cardToken||!n.mqCuiReady){return null}return i("theme-provider",null,i("div",{class:`mq-card-actions ${this.isLoading?"min-height":""}`},this.errorMessage&&this.renderError(),this.isLoading&&this.renderBodySkeleton(),!this.errorMessage&&!this.isLoading&&this.renderCardActions()))}get el(){return e(this)}};b.style=k;export{b as mq_card_actions};
//# sourceMappingURL=p-271ad7c8.entry.js.map