/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{r as e,k as t,i,j as s}from"./p-18a64bdb.js";import{o as r,m as a}from"./p-c7bc8265.js";import{R as n,F as o}from"./p-d6aded2e.js";import{n as l,e as d,p as c,s as m}from"./p-c1f7c0fa.js";import{X as u,Y as p}from"./p-675e89df.js";import{C as h,H as f}from"./p-cb5bbf71.js";import{A as y}from"./p-52af63d3.js";import"./p-0462f723.js";import"./p-324125bc.js";import"./p-bc4f08b6.js";const g={Information:0,Review:1,Terms:2};const v={properties:{firstName:{type:"string",title:"First name",validationRules:[{type:n.stringPattern,value:l,errorMessage:"Cannot contain numbers",priority:1}]},lastName:{type:"string",title:"Last name",validationRules:[{type:n.stringPattern,value:l,errorMessage:"Cannot contain numbers",priority:1}]},email:{type:"string",title:"Email",validationRules:[{type:n.stringPattern,value:d,errorMessage:"Must contain a valid email address",priority:1}]},maskedPhone:{type:"string",title:"Phone",validationRules:[{type:n.stringMinLength,value:12,errorMessage:"Phone number is too short",priority:1},{type:n.stringMaxLength,value:12,errorMessage:"Phone number is too long",priority:2}]},birthDate:{type:"string",title:"Date of birth (MM/DD/YYYY)"},identifierType:{type:"string",title:"Select your identification",oneOf:[{const:"SSN",title:"Social Security Number"},{const:"ITIN",title:"Taxpayer Identification Number"}]},address1:{type:"string",title:"Address line 1",validationRules:[{type:n.stringPattern,value:c,errorMessage:"Cannot contain a P.O. Box",priority:1}]},address2:{type:"string",title:"Address line 2",validationRules:[{type:n.stringPattern,value:c,errorMessage:"Cannot contain a P.O. Box",priority:1}]},city:{type:"string",title:"City",validationRules:[{type:n.stringPattern,value:l,errorMessage:"Cannot contain numbers",priority:1}]},state:{type:"string",title:"State",oneOf:m.map((e=>({const:e.value,title:e.displayName})))},postalCode:{type:"string",title:"Postal code",validationRules:[{type:n.stringMinLength,value:5,errorMessage:"Postal code is too short",priority:1},{type:n.stringMaxLength,value:5,errorMessage:"Postal code is too long",priority:2}]}},required:["firstName","lastName","email","maskedPhone","phone","birthDate","identifierType","identifierValue","identifierMaskedValue","address1","city","state","postalCode"],dependencies:{identifierType:{oneOf:[{properties:{identifierMaskedValue:{type:"string",title:"SSN",validationRules:[{type:n.stringMinLength,value:11,errorMessage:"Field is too short",priority:1},{type:n.stringMaxLength,value:12,errorMessage:"Field is too long",priority:2}]},identifierType:{enum:["SSN"]}},required:["identifierMaskedValue"]},{properties:{identifierMaskedValue:{type:"string",title:"ITIN",validationRules:[{type:n.stringMinLength,value:11,errorMessage:"Field is too short",priority:1},{type:n.stringMaxLength,value:12,errorMessage:"Field is too long",priority:2}]},identifierType:{enum:["ITIN"]}},required:["identifierMaskedValue"]}]}}};const b={"ui:rootFieldId":"kyc","ui:globalOptions":{fieldSets:[{"ui:fields":["firstName","lastName","email","maskedPhone","birthDate"]},{"ui:fields":["identifierType","identifierMaskedValue"]},{"ui:fields":["address1","address2","city","state","postalCode"]}],rowGap:{xs:26,sm:26,md:26,lg:26,xl:26},columnGap:{xs:24,sm:24,md:24,lg:24}},"ui:fields":{firstName:{"ui:columnSpan":{xs:6,sm:6,md:6,lg:6,xl:6}},lastName:{"ui:columnSpan":{xs:6,sm:6,md:6,lg:6,xl:6}},email:{"ui:inputType":"email","ui:columnSpan":{xs:12,sm:6,md:6,lg:6,xl:6}},maskedPhone:{"ui:widget":o.masked,"ui:inputType":"tel","ui:columnSpan":{xs:12,sm:6,md:6,lg:6,xl:6},"ui:maskOptions":{maskOptions:{mask:"000-000-0000"},maskedFieldName:"phone"}},birthDate:{"ui:widget":o.date,"ui:columnSpan":{xs:12,sm:6,md:6,lg:6,xl:6}},identifierType:{"ui:widget":o.select,"ui:columnSpan":{xs:12,sm:6,md:6,lg:6,xl:6}},identifierMaskedValue:{"ui:widget":o.masked,"ui:columnSpan":{xs:12,sm:6,md:6,lg:6,xl:6},"ui:maskOptions":{maskedFieldName:"identifierValue",maskOptions:{mask:"***-**-0000",definitions:{"*":{mask:"0",displayChar:"*"}},overwrite:"shift"}}},city:{"ui:columnSpan":{xs:12,sm:4,md:4,lg:4,xl:4}},state:{"ui:widget":o.select,"ui:columnSpan":{xs:12,sm:4,md:4,lg:4,xl:4}},postalCode:{"ui:widget":o.masked,"ui:columnSpan":{xs:12,sm:4,md:4,lg:4,xl:4},"ui:maskOptions":{maskOptions:{mask:"00000"},maskedFieldName:"postalCode"}}}};const x={identifierType:"SSN",country:"US"};const k={KYC_BAD_ADDRESS:{message:"Send us a scanned copy of one of these documents:",items:["Unexpired state-issued driver's license or identification card","US Military Identification Card","Utility bill (not older than 6 months)","Bank statement","Current rental or lease agreement","Mortgage statement"]},KYC_BAD_DOB:{message:"Please email with one of these documents:",items:["Driver's license or state-issued identification card","Passport"]},KYC_BAD_PHONE:{message:"Please email with one of these documents:",items:["Driver's license or state-issued identification card","US Passport","US Military identification Card","Native American tribal identification card","Government employee identification card","Permanent Resident Alien Card"]},KYC_BAD_SSN:{message:"Please include one of these documents:",items:["Social Security card","Recent W-2 or 1099 showing nine-digit SSN, full name, and address.","ITIN card or document showing ITIN approval"]},KYC_BAD_NAME:{message:"Please email with one of these documents:",items:["Driver's license or state-issued identification card","Passport or US passport card"]},KYC_BAD_EMAIL:{message:"Please email with one of these documents:",items:["Driver's license or state-issued identification card","US Passport","US Military identification Card","Native American tribal identification card","Government employee identification card","Permanent Resident Alien Card"]},KYC_OFAC_FAILURE:{message:"",items:[]}};const S=".account-holder-container{background:var(--components-universal-backgroundColor);border-radius:var(--components-universal-borderRadius);padding:var(--components-universal-padding);border:var(--components-universal-borderWidth) solid var(--components-universal-borderColor)}.account-holder{background-color:var(--styles-background-surfacePrimaryColor)}.error-icon{background:var(--colors-neutral-neutral100);border-radius:var(--borderRadius-radiusFull);padding:0.75rem}.kyc-error-items{margin:0;padding-left:15px;text-align:left}.account-holder-review-key{flex-grow:1}.account-holder-review-value{flex-grow:1;text-align:right}@media (min-width: 575px){.account-holder-review-key{max-width:160px;width:160px}.account-holder-review-value{flex-grow:1;text-align:left}}";const w=S;const C=class{constructor(i){e(this,i);this.mqOnboardAccountHolderLoadInitiated=t(this,"mqOnboardAccountHolderLoadInitiated",7);this.mqOnboardAccountHolderLoadCompleted=t(this,"mqOnboardAccountHolderLoadCompleted",7);this.mqOnboardAccountHolderActionTriggered=t(this,"mqOnboardAccountHolderActionTriggered",7);this.mqOnboardAccountHolderActionCompleted=t(this,"mqOnboardAccountHolderActionCompleted",7);this.mqOnboardAccountHolderActionHook=t(this,"mqOnboardAccountHolderActionHook",7);this.steps=[{key:"information",label:"Information"},{key:"review",label:"Review"},{key:"terms",label:"Terms"}];this.getInitialFormValues=()=>{const e=Object.assign(Object.assign({},x),this.informationFormData&&{firstName:this.informationFormData.firstName,lastName:this.informationFormData.lastName,email:this.informationFormData.email,phone:this.informationFormData.phone,birthDate:this.informationFormData.birthDate,identifierType:this.informationFormData.identifierType,identifierValue:"",identifierMaskedValue:"",address1:this.informationFormData.address1,address2:this.informationFormData.address2,city:this.informationFormData.city,state:this.informationFormData.state,postalCode:this.informationFormData.postalCode});return e};this.handleNextStepChange=async e=>{let t=true;const i=e.detail.step;if(i===g.Information){t=await this.validateInformationStep()}return t};this.validateInformationStep=async()=>{const e=v.required;const t=await this.kycInformationFormRef.submitForm();this.informationFormData=t;if(!t){return false}for(const i of e){if(!t[i]||t[i].trim()===""){return false}}return true};this.validateInformationForm=e=>{const t=e.detail;if(Object.keys(t).length){this.allowInformationFormSubmit=false}else{this.allowInformationFormSubmit=true}};this.handleTermsValidation=e=>{this.allowTermsFormSubmit=e.detail};this.handleKycSubmission=async()=>{var e;try{this.mqOnboardAccountHolderActionTriggered.emit({type:"SUBMIT"});this.submissionState="submitting";const{firstName:e,lastName:t,email:i,phone:s,birthDate:r,address1:a,address2:n,city:o,state:l,postalCode:d,identifierType:c,identifierValue:m}=this.informationFormData;const p=await u({firstName:e,lastName:t,email:i,phone:s,birthDate:r,address1:a,address2:n,city:o,state:l,country:"US",postalCode:d,identifierType:c,identifierValue:m,disclosureTerms:this.allowTermsFormSubmit,userToken:this.userToken});this.userToken=p.userToken;this.submissionState="success";this.mqOnboardAccountHolderActionCompleted.emit({type:"SUBMIT",status:h.SUCCESS,data:{userToken:this.userToken}});y.Onboarding.onboardingVerificationSuccess()}catch(t){this.submissionState="error";let i;let s;if(t instanceof p){i=t===null||t===void 0?void 0:t.msg;s=t.message;this.errorSubmissionCode=i;if((e=t===null||t===void 0?void 0:t.details)===null||e===void 0?void 0:e.userToken){this.userToken=t.details.userToken}}else{s=t.message}this.mqOnboardAccountHolderActionCompleted.emit({type:"SUBMIT",status:h.ERROR,data:{userToken:this.userToken},error:{code:i||"UNKNOWN_KYC_ERROR",message:s}});y.Onboarding.onboardingVerificationError()}};this.handleFormReset=()=>{this.errorSubmissionCode="";this.submissionState="idle";this.mqOnboardAccountHolderActionHook.emit({type:f.ERROR_DONE})};this.disclosures=[];this.rawDisclosures=undefined;this.isEnabled=false;this.submissionState="idle";this.informationFormData=undefined;this.allowInformationFormSubmit=false;this.allowTermsFormSubmit=false;this.errorSubmissionCode=undefined;this.userToken=undefined}componentWillLoad(){var e;this.mqOnboardAccountHolderLoadInitiated.emit();if(!((e=this.disclosures)===null||e===void 0?void 0:e.length)){this.parseDisclosures(this.rawDisclosures)}}connectedCallback(){r(((e,t)=>{if(e&&t){this.isEnabled=t;this.mqOnboardAccountHolderLoadCompleted.emit({status:h.SUCCESS});y.Onboarding.onboardingLoadSuccess()}}),"mq-onboard-account-holder")}parseDisclosures(e){if(!e){return}try{this.disclosures=JSON.parse(e)}catch(e){throw new Error("Unable to parse raw-disclosures")}}renderInformationStepper(){return i("mq-stepper",{totalSteps:3,actionProps:{prevButtonText:"Back",nextButtonText:"Continue",submitButtonText:"Submit",prevBtnProps:{kind:"secondary"},nextBtnProps:{kind:"primary",disabled:!this.allowInformationFormSubmit,fixed:false},submitBtnProps:{disabled:!this.allowTermsFormSubmit,fixed:false}},onNextStepChange:this.handleNextStepChange,onSubmit:this.handleKycSubmission},i("div",{slot:"step-0"},i("flex-container",{flexDirection:"column",gap:"0"},i("mq-text",{type:"heading"},"Personal details"),i("mq-dynamic-form",{ref:e=>this.kycInformationFormRef=e,schema:v,uiSchema:b,initialValues:this.getInitialFormValues(),onDynamicFormValidationTriggered:this.validateInformationForm}))),i("div",{slot:"step-1"},i("flex-container",{flexDirection:"column"},i("mq-text",{type:"heading"},"Review details"),i("mq-onboard-account-holder-review",{reviewData:this.informationFormData}))),i("div",{slot:"step-2"},i("flex-container",{flexDirection:"column"},i("mq-text",{type:"heading"},"Review terms and conditions"),i("mq-onboard-account-holder-terms",{disclosures:this.disclosures,onMqKycTermsValid:this.handleTermsValidation}),i("mq-vspacer",{factor:7}))))}renderSubmittingLoader(){return i("flex-container",{id:"kyc-loader",class:"submission-container",flexDirection:"column",alignItems:"center",gap:"var(--spacing-spacing1000)"},i("mq-lottie-animation",{id:"kyc-loading",loop:true,animation:"indeterminate-loader",styleObject:{height:"40px"},svgStyleObject:{transform:"scale(3)"}}),i("mq-text",{type:"titleSection"},"Verifying your information..."))}renderSubmissionSuccess(){return i("flex-container",{id:"kyc-success",class:"submission-container",flexDirection:"column",alignItems:"center",gap:"var(--spacing-spacing1000)"},i("mq-lottie-animation",{id:"kyc-success",loop:false,animation:"checkmark-final",styleObject:{height:"67.5px"},svgStyleObject:{transform:"scale(1.6)"}}),i("mq-text",{type:"titleSection",styleOverride:{textAlign:"center"}},"Your application was approved"),i("mq-button",{kind:"primary",onClick:()=>this.mqOnboardAccountHolderActionHook.emit({type:f.SUCCESS_DONE})},"Close"))}renderSubmissionError(){var e,t;const s=this.errorSubmissionCode;const r=s?"We were unable to verify your information":"We found some issues with your application. Please try again.";const a=(e=k[s])===null||e===void 0?void 0:e.message;const n=((t=k[s])===null||t===void 0?void 0:t.items)||[];const o=s?"Close":"Return to application";return i("mq-end-card",{showUniversalPadding:false,icon:"circle-error",titleText:r,buttonLabel:o,onMqEndCardButtonClicked:this.handleFormReset},s&&i("flex-container",{flexDirection:"column",gap:"var(--spacing-spacing600)",styleOverride:{marginTop:"var(--spacing-spacing800)"}},i("flex-container",{flexDirection:"row",alignItems:"center"},i("div",null,i("mq-icon",{name:"mail",color:"transparent",class:"error-icon"})),i("mq-text",{styleOverride:{textAlign:"left"}},"Contact kyc@marqeta.com to begin a manual review of your application.")),n.length>0&&i("flex-container",{flexDirection:"row"},i("div",null,i("mq-icon",{name:"attach",color:"transparent",class:"error-icon"})),i("flex-container",{flexDirection:"column",alignItems:"flex-start",gap:"0"},i("mq-text",{styleOverride:{textAlign:"left"}},a),i("ul",{class:"kyc-error-items"},n.map((e=>i("li",null,e))))))))}render(){if(!a.mqCuiReady||!this.isEnabled){return null}return i("theme-provider",null,i("div",{class:"account-holder-container"},i("div",{class:"account-holder"},this.submissionState==="idle"&&this.renderInformationStepper(),this.submissionState==="submitting"&&this.renderSubmittingLoader(),this.submissionState==="success"&&this.renderSubmissionSuccess(),this.submissionState==="error"&&this.renderSubmissionError())))}get el(){return s(this)}static get watchers(){return{rawDisclosures:["parseDisclosures"]}}};C.style=w;export{C as mq_onboard_account_holder};
//# sourceMappingURL=p-f901dc45.entry.js.map