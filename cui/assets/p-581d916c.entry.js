/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{r as t,k as e,i as s,j as i}from"./p-18a64bdb.js";import{c as n,E as o,B as a,C as r,a as h,F as c,D as m}from"./p-675e89df.js";import{o as d,m as f}from"./p-c7bc8265.js";import{C as l}from"./p-cb5bbf71.js";import"./p-52af63d3.js";import{i as p}from"./p-fd1eb924.js";import"./p-0462f723.js";const u="this file is auto-populated during blackbird builds";const b="0.0.0";const v="";const g="branchNameHere";const j="0";const w="";const I="";const $={description:u,version:b,previous_version:v,branch:g,build_number:j,commit:w,created_time:I};var y=undefined&&undefined.__rest||function(t,e){var s={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)s[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++){if(e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n]))s[i[n]]=t[i[n]]}return s};const N=class{constructor(s){t(this,s);this.mqIframeComponentLoadCompleted=e(this,"mqIframeComponentLoadCompleted",7);this.loadEnvConfigVars=async()=>{const t=n.get(o);const e=n.get(a);this.programShortCode=await r();this.activeEnvName=t.execute();this.cuiIframeBaseUrl=e.execute("CUI_IFRAME_BASE_URL")};this.component=undefined;this.iframeTitle=undefined;this.props=undefined;this.eventProxyParent=undefined;this.allow=undefined;this.activeEnvName="";this.cuiIframeBaseUrl=undefined;this.iframeSrc="";this.isLoading=true;this.isMobile=undefined;this.programShortCode=undefined;this.themeName=""}connectedCallback(){d((t=>{t&&(async()=>{await this.loadEnvConfigVars();this.iframeSrc=this.buildIframeSrcUrl()})()}));this.isMobile=p();this.initializeIframeResizeListener();this.initializeIframeEventProxy()}buildIframeSrcUrl(){console.log({versionJson:$});if(this.activeEnvName==="localhost"){return`${this.cuiIframeBaseUrl}/static/iframe-component`}let t;const{version:e,branch:s}=$;const i="/www/iframe-page-root/index.html";if(this.activeEnvName==="development"){t=`/branches/${s}`}else{const[s]=e.match(/^[0-9]+\.[0-9]+/);t=`/${this.programShortCode}/releases/${s}`}return`${this.cuiIframeBaseUrl}${t}${i}`}initializeIframeResizeListener(){window.addEventListener("message",(t=>{const{data:{eventName:e,componentName:s,height:i},origin:n}=t;if(n===this.cuiIframeBaseUrl&&e==="iframeBodyResize"&&s===this.component){this.iframeElement.style.height=`${i}px`}}))}initializeIframeEventProxy(){if(this.eventProxyParent){const t=n.get(a);const e=t.execute("CUI_IFRAME_BASE_URL");window.addEventListener("message",(t=>{if(t.origin===e){this.proxyEventIfApplicableToComponent(t)}}))}}proxyEventIfApplicableToComponent(t){const e=t.data,{eventName:s,componentName:i}=e,n=y(e,["eventName","componentName"]);if(i===this.component){if(this.eventProxyParent.hasOwnProperty(s)){this.eventProxyParent[s].emit(n)}else if(typeof this.eventProxyParent[`${s}Handler`]==="function"){const t=new CustomEvent(s,{detail:n});this.eventProxyParent[`${s}Handler`](t)}}}handleIframeLoaded(){this.isLoading=false;this.sendThemeViaPostMessage();this.sendPropsViaPostMessage();this.mqIframeComponentLoadCompleted.emit({status:l.SUCCESS,data:{component:this.component}})}sendThemeViaPostMessage(){const t=n.get(h);const{theme:e}=t.execute();const s=this.iframeElement.contentWindow;s.postMessage({message:"setTheme",theme:e},this.cuiIframeBaseUrl)}sendPropsViaPostMessage(){const t=this.iframeElement.contentWindow;t.postMessage({message:"setProps",globalProps:this.getGlobalProps(),componentProps:this.props},this.cuiIframeBaseUrl)}getGlobalProps(){const t=n.get(c);const e=n.get(m);const s=n.get(o);const i=n.get(h);const{themeName:a}=i.execute();return{authToken:t.execute(),componentName:this.component,envName:s.execute(),isMockMode:e.execute(),themeName:a}}async reloadIframe(){this.iframeElement.src=this.iframeSrc;return}handleIframeError(){this.mqIframeComponentLoadCompleted.emit({status:l.ERROR,data:{component:this.component}})}render(){if(!f.mqCuiReady||!this.cuiIframeBaseUrl||!this.iframeSrc){return null}return s("iframe",{src:this.iframeSrc,ref:t=>this.iframeElement=t,onLoad:()=>this.handleIframeLoaded(),onError:()=>this.handleIframeError(),frameBorder:"0",scrolling:"no",title:this.iframeTitle,allow:this.allow,style:{display:`${this.isLoading?"none":"flex"}`,flex:"1","justify-content":"center",width:"100%","min-height":`${this.isMobile?"100%":"0"}`}})}get el(){return i(this)}};export{N as mq_iframe_component};
//# sourceMappingURL=p-581d916c.entry.js.map