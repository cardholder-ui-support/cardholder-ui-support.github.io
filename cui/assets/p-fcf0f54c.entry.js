/**
 * Cardholder UI Web Components v0.22.0
 * (c) 2024 Marqeta
 * @license MIT
 */
import{r as e,k as r,i as t}from"./p-18a64bdb.js";import{o as i,m as a}from"./p-c7bc8265.js";import{c as s,Z as o,z as d,_ as n,C as l,$ as c}from"./p-675e89df.js";import{A as u}from"./p-52af63d3.js";import{B as h}from"./p-3b5975cd.js";import{R as p,D as v}from"./p-747ef1bd.js";import{C as b,H as m}from"./p-cb5bbf71.js";import"./p-0462f723.js";import"./p-324125bc.js";import"./p-bc4f08b6.js";import"./p-c1f7c0fa.js";import"./p-d6aded2e.js";const f=".replace-card-container{background:var(--components-universal-backgroundColor);padding:var(--components-universal-padding);border-radius:var(--components-universal-borderRadius);border:var(--components-universal-borderWidth) solid var(--components-universal-borderColor)}.replace-card{background-color:var(--styles-background-surfacePrimaryColor);border-radius:var(--borderRadius-radius0)}.replace-card-container .dynamic-field-set{padding:0}.replace-card-option-icon{align-self:flex-start;margin-top:var(--spacing-spacing100)}.replace-options .mq-list-item{border:var(--styles-border-borderWidth) solid var(--styles-border-borderDefaultColor)}.replace-options>mq-list-item:nth-child(2) .mq-list-item{border-top:none;border-bottom:none}.replace-virtual-card-button{align-self:flex-end}.replace-option:hover{background:var(--styles-background-surfacePrimaryHoverColor)}.replace-option:active{background:var(--styles-background-surfacePrimaryActiveColor)}.replace-option:first-child:active{border-top-left-radius:var(--borderRadius-radius200);border-top-right-radius:var(--borderRadius-radius200)}.replace-option:last-child:active{border-bottom-left-radius:var(--borderRadius-radius200);border-bottom-right-radius:var(--borderRadius-radius200)}.replace-option:focus-visible{outline-width:2px;outline-style:solid;outline-offset:2px;outline-color:var(--styles-border-focusOutlineColor);border-radius:var(--borderRadius-radius200);background:var(--styles-background-surfacePrimaryHoverColor);z-index:1}.replace-option:first-child:focus-visible{border-top-left-radius:var(--borderRadius-radius200);border-top-right-radius:var(--borderRadius-radius200)}.replace-option:last-child:focus-visible{border-bottom-left-radius:var(--borderRadius-radius200);border-bottom-right-radius:var(--borderRadius-radius200)}.replace-option:first-child{border-bottom:0;border-top-left-radius:var(--borderRadius-radius200);border-top-right-radius:var(--borderRadius-radius200)}.replace-option:last-child{border-top:0;border-bottom-left-radius:var(--borderRadius-radius200);border-bottom-right-radius:var(--borderRadius-radius200)}.replace-card-error{padding:var(--spacing-spacing1000) var(--spacing-spacing600)}.replace-card-error-refresh{cursor:pointer;padding:var(--spacing-spacing200) var(--spacing-spacing400)}.replace-card-error-refresh:focus-visible{outline-width:2px;outline-style:solid;outline-offset:2px;outline-color:var(--styles-border-focusOutlineColor);border-radius:var(--borderRadius-radius200)}.replace-card-confirm-mailing-address{flex:1 0 0;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;gap:var(--spacing-spacing100)}";const g=f;const y="in 7-10 days";var C;(function(e){e["Lost"]="10";e["Stolen"]="23";e["Damaged"]="31"})(C||(C={}));const R=class{constructor(t){e(this,t);this.mqReplaceCardLoadInitiated=r(this,"mqReplaceCardLoadInitiated",7);this.mqReplaceCardLoadCompleted=r(this,"mqReplaceCardLoadCompleted",7);this.mqReplaceCardActionHook=r(this,"mqReplaceCardActionHook",7);this.mqReplaceCardActionTriggered=r(this,"mqReplaceCardActionTriggered",7);this.mqReplaceCardActionCompleted=r(this,"mqReplaceCardActionCompleted",7);this.handleSelectReplaceReason=e=>{try{this.reason=e;this.isConfirmMailing=true;u.CardManagement.replaceCardSuccess(e)}catch(r){this.triggerReplaceError=true;u.CardManagement.replaceCardError(e)}};this.handleKeyPress=(e,r)=>{if(e.key==="Enter"){r()}};this.getReasonCode=e=>C[e];this.handleReplaceCard=async()=>{var e,r,t,i,a,d,n;this.mqReplaceCardActionTriggered.emit({type:p.REPLACE_CARD,data:{isPhysical:this.isPhysical,cardToken:this.cardToken}});this.isLoading=true;try{const e=this.getReasonCode(this.reason);const r=s.get(o);await r.execute(this.cardToken,this.card.cardProductToken,e);this.mqReplaceCardActionCompleted.emit({type:p.REPLACE_CARD,status:b.SUCCESS,data:{isPhysical:this.isPhysical,cardToken:this.cardToken}});this.isSuccess=true;if(this.isPhysical){u.CardManagement.replacePhysicalCardSuccess()}else{u.CardManagement.replaceVirtualCardSuccess()}}catch(s){this.triggerReplaceError=true;const o=(e=s===null||s===void 0?void 0:s.originalError)===null||e===void 0?void 0:e.message;const l=(t=(r=s===null||s===void 0?void 0:s.originalError)===null||r===void 0?void 0:r.debug)===null||t===void 0?void 0:t[0];this.mqReplaceCardActionCompleted.emit({type:p.REPLACE_CARD,status:b.ERROR,data:{isPhysical:this.isPhysical,cardToken:this.cardToken},error:{code:o||"REPLACE_CARD_ERROR",message:(n=(a=(i=l===null||l===void 0?void 0:l.data)===null||i===void 0?void 0:i.error_message)!==null&&a!==void 0?a:(d=l===null||l===void 0?void 0:l.data)===null||d===void 0?void 0:d.description)!==null&&n!==void 0?n:v}});if(this.isPhysical){u.CardManagement.replacePhysicalCardError()}else{u.CardManagement.replaceVirtualCardError()}}finally{this.isLoading=false}};this.handleNextClick=e=>{const r=e.detail.formRef;const t=window.Event;const i=new t("submit",{bubbles:false,cancelable:true});r.dispatchEvent(i)};this.handleBackClick=()=>{this.isSaveAddressError=false;if(this.isEditing){this.isEditing=false}else{this.isConfirmMailing=false}};this.handleFormSubmit=e=>{const{updatedMailingAddress:r}=e.detail;this.changeAddress(r)};this.handleEditForm=()=>{this.isEditing=true};this.handleDoneClick=e=>()=>{this.mqReplaceCardActionHook.emit({type:e,data:{isPhysical:this.isPhysical,cardToken:this.cardToken}})};this.cardToken=undefined;this.deliveryTime=y;this.showSuccess=undefined;this.showTitle=true;this.showDescription=true;this.isPhysical=true;this.allowSubmit=true;this.cardType=undefined;this.initError=undefined;this.isConfirmMailing=false;this.isLoading=true;this.isEditing=false;this.isSaveAddressError=false;this.isSuccess=undefined;this.programShortcode=undefined;this.reason=C.Damaged;this.replaceCardFormData=undefined;this.triggerReplaceError=undefined;this.user=undefined;this.card=undefined;this.options=[{value:"Lost",label:"Lost",description:"Your card will be canceled, and you’ll receive a replacement with a new card number."},{value:"Stolen",label:"Stolen",description:"Your card will be canceled, and you’ll receive a replacement with a new card number."},{value:"Damaged",label:"Damaged",description:"Your card will be reissued, and you’ll receive a replacement with the same card number."}]}selectTriggeredEventHandler(e){this.handleSelectReplaceReason(e.detail.id)}connectedCallback(){i((e=>{if(e){this.loadUser()}}));this.mqReplaceCardLoadInitiated.emit({data:{cardToken:this.cardToken}})}async loadUser(){var e,r,t,i,a,s,o;try{await this.tryToLoadUser();this.mqReplaceCardLoadCompleted.emit({status:b.SUCCESS})}catch(d){this.initError=true;const n=(e=d===null||d===void 0?void 0:d.originalError)===null||e===void 0?void 0:e.message;const l=(t=(r=d===null||d===void 0?void 0:d.originalError)===null||r===void 0?void 0:r.debug)===null||t===void 0?void 0:t[0];this.mqReplaceCardLoadCompleted.emit({status:b.ERROR,error:{code:n||"REPLACE_CARD_ERROR",message:(o=(a=(i=l===null||l===void 0?void 0:l.data)===null||i===void 0?void 0:i.error_message)!==null&&a!==void 0?a:(s=l===null||l===void 0?void 0:l.data)===null||s===void 0?void 0:s.description)!==null&&o!==void 0?o:v}})}finally{this.isLoading=false}}async tryToLoadUser(){const e=s.get(d);const r=s.get(n);const t=await e.execute(this.cardToken);const i=await r.execute();const a=await l();this.card=t;this.user=i;this.programShortcode=a;this.isPhysical=Boolean(t.instrumentType.toLowerCase().includes("physical"));this.allowSubmit=!!this.user.address1}getUserMailingAddress(){const{address1:e,address2:r,city:t,state:i,postalCode:a}=this.user;return{address1:e,address2:r,city:t,state:i,postalCode:a}}async changeAddress(e){this.isLoading=true;const r=s.get(c);const t=Object.assign(Object.assign({},e),{state:this.extractStateAbbreviation(e.state)});try{await r.execute(t);await this.tryToLoadUser();u.CardManagement.changeAddressSuccess()}catch(e){this.handleChangeAddressError()}finally{this.isLoading=false;this.isEditing=false}}extractStateAbbreviation(e){return e.split(" - ")[0]}handleChangeAddressError(){u.CardManagement.changeAddressError();this.isSaveAddressError=true}renderInitError(){return t("theme-provider",null,t("div",{class:"replace-card-container"},t("flex-container",{class:"replace-card",flexDirection:"column"},t("flex-container",{class:"replace-card-error",flexDirection:"column",alignItems:"center",gap:"var(--spacing-spacing400)"},t("mq-text",{content:"Unable to load data"}),t("mq-button",{type:"button",kind:"tertiary",onClick:()=>this.loadUser(),onKeyPress:e=>this.handleKeyPress(e,(()=>this.loadUser()))},"Refresh")))))}renderSuccess(){const e=this.isPhysical?"Your replacement card is on its way":"Your new virtual card is ready to use";const r=this.isPhysical?"Remember to update your saved or automatic payments with your new card details.":"You can start using your card immediately.";const i=this.isPhysical?"Replace Card":"Replace Virtual Card";return t("mq-end-card",{icon:"checkmark-final",showAnimation:true,titleText:e,subtitleText:r,buttonSize:h.large,name:i,onMqEndCardButtonClicked:this.handleDoneClick(m.SUCCESS_DONE)})}renderError(){const e=this.isPhysical?"Replace Card":"Replace Virtual Card";return t("mq-end-card",{icon:"circle-error",titleText:"Unable to replace card",subtitleText:"We are unable to replace your card at this time. Try again or contact customer support.",buttonSize:h.large,name:e,onMqEndCardButtonClicked:this.handleDoneClick(m.ERROR_DONE)})}renderPhysicalReplaceCard(){return t("div",{class:"replace-card-container"},t("flex-container",{class:"replace-card",flexDirection:"column",gap:"var(--spacing-spacing600)"},(this.showTitle||this.showDescription)&&t("flex-container",{class:"replace-options",flexDirection:"column",gap:"var(--spacing-spacing200)"},this.showTitle&&t("mq-text",{type:"heading",content:"Replace card"}),this.showDescription&&t("mq-text",{colorType:"secondary",content:"Choose one of the options below, and we'll help you get a new card."})),t("flex-container",{class:"replace-options",flexDirection:"column",gap:"0px"},this.options.map((e=>t("mq-list-item",{key:e.value,"data-key":e.value,itemId:e.value,titleKey:e.label,subheadingKey:e.description,programShortcode:this.programShortcode}))))))}renderVirtualReplaceCard(){return t("div",{class:"replace-card-container"},t("flex-container",{class:"replace-card",flexDirection:"column",gap:"var(--spacing-spacing1000)"},t("flex-container",{flexDirection:"column",gap:"var(--spacing-spacing600)"},this.showTitle&&t("mq-text",{type:"heading",content:"Replace virtual card"}),this.showDescription&&t("mq-text",{colorType:"secondary",content:"Your card will be canceled, and you'll receive a new card number."})),t("mq-button",{class:"replace-virtual-card-button",small:true,"test-id":"replace-virtual-card-button",kind:"primary",onClick:()=>this.handleReplaceCard()},"Replace card")))}render(){if(!this.cardToken||!a.mqCuiReady)return null;if(this.initError)return this.renderInitError();if(this.isSuccess&&this.showSuccess)return this.renderSuccess();if(this.triggerReplaceError)return this.renderError();if(this.isConfirmMailing)return t("mq-confirm-mailing-address",{cardToken:this.cardToken,allowSubmit:this.allowSubmit,deliveryTime:this.deliveryTime,isLoading:this.isLoading,isEditing:this.isEditing,mailingAddress:this.getUserMailingAddress(),reason:this.reason,error:this.isSaveAddressError,onNextButtonClick:this.handleNextClick,onBackButtonClick:this.handleBackClick,onReplaceCardButtonClick:this.handleReplaceCard,onEditButtonClick:this.handleEditForm,onChangeAddressSubmitTriggered:this.handleFormSubmit});return t("theme-provider",null,this.isPhysical?this.renderPhysicalReplaceCard():this.renderVirtualReplaceCard())}};R.style=g;export{R as mq_replace_card};
//# sourceMappingURL=p-fcf0f54c.entry.js.map